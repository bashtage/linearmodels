<!DOCTYPE html> <html lang=en > <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1.0" /><meta name=generator  content="Docutils 0.19: https://docutils.sourceforge.io/" /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../../_static/javascripts/modernizr.js"></script> <title>Basic Examples &#8212; linearmodels 4.28.dev47+g9cc61bdb9 documentation</title> <link rel=apple-touch-icon  sizes=180x180  href="../../_static/icons/apple-touch-icon.png"> <link rel=icon  type="image/png" sizes=32x32  href="../../_static/icons/favicon-32x32.png"> <link rel=icon  type="image/png" sizes=16x16  href="../../_static/icons/favicon-16x16.png"> <link rel=manifest  href="../../_static/icons/site.webmanifest"> <link rel=mask-icon  href="../../_static/icons/safari-pinned-tab.svg" color="#2196f3"> <link rel="shortcut icon" href="../../_static/icons/favicon.ico"> <meta name=msapplication-TileColor  content="#f8f8f8"> <meta name=msapplication-config  content="../../_static/icons/browserconfig.xml"> <style> .highlight { background-color: hsla(0,0%,92.5%,.5) !important; } </style> <link rel=stylesheet  type="text/css" href="../../_static/pygments.css" /> <link rel=stylesheet  type="text/css" href="../../_static/material.css" /> <script data-url_root="../../" id=documentation_options  src="../../_static/documentation_options.js"></script> <script src="../../_static/jquery.js"></script> <script src="../../_static/underscore.js"></script> <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script> <script src="../../_static/doctools.js"></script> <script src="../../_static/sphinx_highlight.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script> <script defer=defer  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <link rel="shortcut icon" href="../../_static/favicon.ico"/> <link rel=index  title=Index  href="../../genindex.html" /> <link rel=search  title=Search  href="../../search.html" /> <link rel=next  title="Further Examples" href=advanced-examples.html  /> <link rel=prev  title=Introduction  href="../introduction.html" /> <body dir=ltr data-md-color-primary=blue data-md-color-accent=orange> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#iv/examples/basic-examples" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../../index.html" title="linearmodels 4.28.dev47+g9cc61bdb9 documentation" class="md-header-nav__button md-logo"> <img src="../../_static/bw-logo.svg" height=26  alt="linearmodels 4.28.dev47+g9cc61bdb9 documentation logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >linearmodels v4.28 (+47)</span> <span class=md-header-nav__topic > Basic Examples </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=Search  autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source > <a href="https://github.com/bashtage/linearmodels/" title="Go to repository" class=md-source  data-md-source=github > <div class=md-source__icon > <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width=28  height=28 > <use xlink:href="#__github" width=24  height=24 ></use> </svg> </div> <div class=md-source__repository > linearmodels </div> </a> </div> </div> <div class="md-flex__cell md-flex__cell--shrink dropdown"> <button class=dropdownbutton >Versions</button> <div class="dropdown-content md-hero"> <a title=Release  href="https://bashtage.github.io/linearmodels/">Release</a> <a title=Development  href="https://bashtage.github.io/linearmodels/devel/">Development</a> </div> </div> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Instrumental Variable Estimation</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../../index.html" title="linearmodels 4.28.dev47+g9cc61bdb9 documentation" class="md-nav__button md-logo"> <img src="../../_static/bw-logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../../index.html" title="linearmodels 4.28.dev47+g9cc61bdb9 documentation">linearmodels v4.28 (+47)</a> </label> <div class=md-nav__source > <a href="https://github.com/bashtage/linearmodels/" title="Go to repository" class=md-source  data-md-source=github > <div class=md-source__icon > <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width=28  height=28 > <use xlink:href="#__github" width=24  height=24 ></use> </svg> </div> <div class=md-source__repository > linearmodels </div> </a> </div> <ul class=md-nav__list > <li class=md-nav__item > <a href="../index.html" class=md-nav__link >Instrumental Variable Estimation</a> <ul class=md-nav__list > <li class=md-nav__item > <a href="../introduction.html" class=md-nav__link >Introduction</a> <li class=md-nav__item > <input class="md-toggle md-nav__toggle" data-md-toggle=toc  type=checkbox  id=__toc > <label class="md-nav__link md-nav__link--active" for=__toc > Basic Examples </label> <a href="#" class="md-nav__link md-nav__link--active">Basic Examples</a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >Contents</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#iv-examples-basic-examples--page-root" class=md-nav__link >Basic Examples</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Wages-of-Married-Women" class=md-nav__link >Wages of Married Women</a> <li class=md-nav__item ><a href="#Wages-of-Men" class=md-nav__link >Wages of Men</a> <li class=md-nav__item ><a href="#Weighted-IV" class=md-nav__link >Weighted IV</a> <li class=md-nav__item ><a href="#Smoking-and-birth-weight" class=md-nav__link >Smoking and birth weight</a> <li class=md-nav__item ><a href="#Proximity-and-education" class=md-nav__link >Proximity and education</a> <li class=md-nav__item ><a href="#Formula-interface" class=md-nav__link >Formula interface</a> <li class=md-nav__item ><a href="#Categorical-Variables" class=md-nav__link >Categorical Variables</a> <li class=md-nav__item ><a href="#Post-estimation-diagnostics" class=md-nav__link >Post-estimation diagnostics</a> <li class=md-nav__item ><a href="#Panel-IV" class=md-nav__link >Panel IV</a> </ul> </nav> <li class=md-nav__item ><a class=md-nav__extra_link  href="../../_sources/iv/examples/basic-examples.ipynb.txt">Show Source</a> </ul> </nav> <li class=md-nav__item > <a href=advanced-examples.html  class=md-nav__link >Further Examples</a> <li class=md-nav__item > <a href=using-formulas.html  class=md-nav__link >Using formulas to specify models</a> <li class=md-nav__item > <a href=absorbing-regression.html  class=md-nav__link >Absorbing Regression</a> <li class=md-nav__item > <a href="../reference.html" class=md-nav__link >Module Reference</a> <li class=md-nav__item > <a href="../mathematical-formula.html" class=md-nav__link >Formulas and Mathematical Detail</a> </ul> <li class=md-nav__item > <a href="../../panel/index.html" class=md-nav__link >Panel Data Model Estimation</a> <li class=md-nav__item > <a href="../../asset-pricing/index.html" class=md-nav__link >Linear Factor Models for Asset Pricing</a> <li class=md-nav__item > <a href="../../system/index.html" class=md-nav__link >System Regression Models</a> <li class=md-nav__item > <a href="../../utility.html" class=md-nav__link >Utilities</a> <li class=md-nav__item > <a href="../../compatibility.html" class=md-nav__link >Compatibility</a> <li class=md-nav__item > <a href="../../plan.html" class=md-nav__link >Module Plans</a> <li class=md-nav__item > <a href="../../contributing.html" class=md-nav__link >Contributing</a> <li class=md-nav__item > <a href="../../changes.html" class=md-nav__link >Change Log</a> <li class=md-nav__item > <a href="../../references.html" class=md-nav__link >References</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >Contents</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#iv-examples-basic-examples--page-root" class=md-nav__link >Basic Examples</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Wages-of-Married-Women" class=md-nav__link >Wages of Married Women</a> <li class=md-nav__item ><a href="#Wages-of-Men" class=md-nav__link >Wages of Men</a> <li class=md-nav__item ><a href="#Weighted-IV" class=md-nav__link >Weighted IV</a> <li class=md-nav__item ><a href="#Smoking-and-birth-weight" class=md-nav__link >Smoking and birth weight</a> <li class=md-nav__item ><a href="#Proximity-and-education" class=md-nav__link >Proximity and education</a> <li class=md-nav__item ><a href="#Formula-interface" class=md-nav__link >Formula interface</a> <li class=md-nav__item ><a href="#Categorical-Variables" class=md-nav__link >Categorical Variables</a> <li class=md-nav__item ><a href="#Post-estimation-diagnostics" class=md-nav__link >Post-estimation diagnostics</a> <li class=md-nav__item ><a href="#Panel-IV" class=md-nav__link >Panel IV</a> </ul> </nav> <li class=md-nav__item ><a class=md-nav__extra_link  href="../../_sources/iv/examples/basic-examples.ipynb.txt">Show Source</a> <li id=searchbox  class=md-nav__item > </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <style> /* CSS for nbsphinx extension */ /* remove conflicting styling from Sphinx themes */ div.nbinput.container div.prompt *, div.nboutput.container div.prompt *, div.nbinput.container div.input_area pre, div.nboutput.container div.output_area pre, div.nbinput.container div.input_area .highlight, div.nboutput.container div.output_area .highlight { border: none; padding: 0; margin: 0; box-shadow: none; } div.nbinput.container > div[class*=highlight], div.nboutput.container > div[class*=highlight] { margin: 0; } div.nbinput.container div.prompt *, div.nboutput.container div.prompt * { background: none; } div.nboutput.container div.output_area .highlight, div.nboutput.container div.output_area pre { background: unset; } div.nboutput.container div.output_area div.highlight { color: unset; /* override Pygments text color */ } /* avoid gaps between output lines */ div.nboutput.container div[class*=highlight] pre { line-height: normal; } /* input/output containers */ div.nbinput.container, div.nboutput.container { display: -webkit-flex; display: flex; align-items: flex-start; margin: 0; width: 100%; } @media (max-width: 540px) { div.nbinput.container, div.nboutput.container { flex-direction: column; } } /* input container */ div.nbinput.container { padding-top: 5px; } /* last container */ div.nblast.container { padding-bottom: 5px; } /* input prompt */ div.nbinput.container div.prompt pre { color: #307FC1; } /* output prompt */ div.nboutput.container div.prompt pre { color: #BF5B3D; } /* all prompts */ div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: 4.5ex; padding-top: 5px; position: relative; user-select: none; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: absolute; right: 0; margin-right: 0.3ex; } @media (max-width: 540px) { div.nbinput.container div.prompt, div.nboutput.container div.prompt { width: unset; text-align: left; padding: 0.4em; } div.nboutput.container div.prompt.empty { padding: 0; } div.nbinput.container div.prompt > div, div.nboutput.container div.prompt > div { position: unset; } } /* disable scrollbars on prompts */ div.nbinput.container div.prompt pre, div.nboutput.container div.prompt pre { overflow: hidden; } /* input/output area */ div.nbinput.container div.input_area, div.nboutput.container div.output_area { -webkit-flex: 1; flex: 1; overflow: auto; } @media (max-width: 540px) { div.nbinput.container div.input_area, div.nboutput.container div.output_area { width: 100%; } } /* input area */ div.nbinput.container div.input_area { border: 1px solid #e0e0e0; border-radius: 2px; /*background: #f5f5f5;*/ } /* override MathJax center alignment in output cells */ div.nboutput.container div[class*=MathJax] { text-align: left !important; } /* override sphinx.ext.imgmath center alignment in output cells */ div.nboutput.container div.math p { text-align: left; } /* standard error */ div.nboutput.container div.output_area.stderr { background: #fdd; } /* ANSI colors */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-default-inverse-fg { color: #FFFFFF; } .ansi-default-inverse-bg { background-color: #000000; } .ansi-bold { font-weight: bold; } .ansi-underline { text-decoration: underline; } div.nbinput.container div.input_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight] > pre, div.nboutput.container div.output_area div[class*=highlight].math, div.nboutput.container div.output_area.rendered_html, div.nboutput.container div.output_area > div.output_javascript, div.nboutput.container div.output_area:not(.rendered_html) > img{ padding: 5px; margin: 0; } /* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */ div.nbinput.container div.input_area > div[class^='highlight'], div.nboutput.container div.output_area > div[class^='highlight']{ overflow-y: hidden; } /* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */ .prompt .copybtn { display: none; } /* Some additional styling taken form the Jupyter notebook CSS */ .jp-RenderedHTMLCommon table, div.rendered_html table { border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed; } .jp-RenderedHTMLCommon thead, div.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom; } .jp-RenderedHTMLCommon tr, .jp-RenderedHTMLCommon th, .jp-RenderedHTMLCommon td, div.rendered_html tr, div.rendered_html th, div.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none; } .jp-RenderedHTMLCommon th, div.rendered_html th { font-weight: bold; } .jp-RenderedHTMLCommon tbody tr:nth-child(odd), div.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5; } .jp-RenderedHTMLCommon tbody tr:hover, div.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2); } </style> <section id=Basic-Examples > <h1 id=iv-examples-basic-examples--page-root >Basic Examples<a class=headerlink  href="#iv-examples-basic-examples--page-root" title="Permalink to this heading">¶</a></h1> <p>These examples are based on <strong>Chapter 15</strong> of <em>Introduction to Econometrics</em> by Jeffrey Wooldridge and demonstrate the basic use of the IV estimators (primarily IV2SLS – the two-stage least squares estimator)</p> <section id=Wages-of-Married-Women > <h2 id=Wages-of-Married-Women >Wages of Married Women<a class=headerlink  href="#Wages-of-Married-Women" title="Permalink to this heading">¶</a></h2> <p>This first example examines the effect of education on the wages of women. Education is a classic endogenous variable since it has signaling value beyond the actual direct effect (among other reasons).</p> <p>This first block imports the data and uses the <code class="docutils literal notranslate"><span class=pre >DESCR</span></code> attribute to describe the dataset. <code class="docutils literal notranslate"><span class=pre >add_constant</span></code> from statsmodels is used to add a variable named <code class="docutils literal notranslate"><span class=pre >const</span></code> to the DataFrame. Observations with missing values are dropped.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[1]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >numpy</span> <span class=k >as</span> <span class=nn >np</span>
<span class=kn >from</span> <span class=nn >linearmodels.datasets</span> <span class=kn >import</span> <span class=n >mroz</span>
<span class=kn >from</span> <span class=nn >statsmodels.api</span> <span class=kn >import</span> <span class=n >add_constant</span>

<span class=nb >print</span><span class=p >(</span><span class=n >mroz</span><span class=o >.</span><span class=n >DESCR</span><span class=p >)</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >mroz</span><span class=o >.</span><span class=n >load</span><span class=p >()</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >data</span><span class=o >.</span><span class=n >dropna</span><span class=p >()</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >add_constant</span><span class=p >(</span><span class=n >data</span><span class=p >,</span> <span class=n >has_constant</span><span class=o >=</span><span class=s2 >"add"</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>

T.A. Mroz (1987), "The Sensitivity of an Empirical Model of Married Women's
Hours of Work to Economic and Statistical Assumptions," Econometrica 55,
765-799.

nlf        1 if in labor force, 1975
hours      hours worked, 1975
kidslt6    # kids &lt; 6 years
kidsge6    # kids 6-18
age        woman's age in yrs
educ       years of schooling
wage       estimated wage from earns., hours
repwage    reported wage at interview in 1976
hushrs     hours worked by husband, 1975
husage     husband's age
huseduc    husband's years of schooling
huswage    husband's hourly wage, 1975
faminc     family income, 1975
mtr        fed. marginal tax rate facing woman
motheduc   mother's years of schooling
fatheduc   father's years of schooling
unem       unem. rate in county of resid.
city       =1 if live in SMSA
exper      actual labor mkt exper
nwifeinc   (faminc - wage*hours)/1000
lwage      log(wage)
expersq    exper^2

</pre></div></div> </div> <p>Since OLS is a special case of 2SLS, IV2SLS can be used to estimate a model using OLS by setting <code class="docutils literal notranslate"><span class=pre >endog</span></code> and <code class="docutils literal notranslate"><span class=pre >instruments</span></code> variables to <code class="docutils literal notranslate"><span class=pre >None</span></code>.</p> <p>This first regression uses OLS to estimate the effect of education on the log of wage. It indicates that 1 year of education increases wage by 10%.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >linearmodels.iv</span> <span class=kn >import</span> <span class=n >IV2SLS</span>

<span class=n >res_ols</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >wage</span><span class=p >),</span> <span class=n >data</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"educ"</span><span class=p >]],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span>
    <span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span>
<span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_ols</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:                   wage   R-squared:                      0.1179
Estimator:                        OLS   Adj. R-squared:                 0.1158
No. Observations:                 428   F-statistic:                    57.196
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:36   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const         -0.1852     0.1848    -1.0022     0.3163     -0.5474      0.1770
educ           0.1086     0.0144     7.5628     0.0000      0.0805      0.1368
==============================================================================
</pre></div></div> </div> <p>Two-stage least squares is estimated “as-if” two regressions are run. Here the first stage regression where OLS is used to fit the value on the instrument (in this case the education of the subject”s father). The fitted value is saved for use later.</p> <p>This first stage regression indicates that there is a strong relationship and the first stage easily passes the rule of thumb test where the F-statistic is at least 10.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res_first</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >educ</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"fatheduc"</span><span class=p >]],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span>
    <span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span>
<span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_first</span><span class=p >)</span>
<span class=n >data</span><span class=p >[</span><span class=s2 >"educ_hat"</span><span class=p >]</span> <span class=o >=</span> <span class=n >data</span><span class=o >.</span><span class=n >educ</span> <span class=o >-</span> <span class=n >res_first</span><span class=o >.</span><span class=n >resids</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:                   educ   R-squared:                      0.1726
Estimator:                        OLS   Adj. R-squared:                 0.1706
No. Observations:                 428   F-statistic:                    89.258
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:36   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          10.237     0.2753     37.186     0.0000      9.6975      10.777
fatheduc       0.2694     0.0285     9.4476     0.0000      0.2135      0.3253
==============================================================================
</pre></div></div> </div> <p>The second stage uses the instrument to fit the model. This model indicates a much lower effect of education.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res_second</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >wage</span><span class=p >),</span> <span class=n >data</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >]],</span> <span class=n >data</span><span class=o >.</span><span class=n >educ</span><span class=p >,</span> <span class=n >data</span><span class=o >.</span><span class=n >fatheduc</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span>
    <span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span>
<span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_second</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                   wage   R-squared:                      0.0934
Estimator:                    IV-2SLS   Adj. R-squared:                 0.0913
No. Observations:                 428   F-statistic:                    2.8487
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0914
Time:                        08:16:36   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          0.4411     0.4451     0.9911     0.3216     -0.4312      1.3134
educ           0.0592     0.0351     1.6878     0.0914     -0.0095      0.1279
==============================================================================

Endogenous: educ
Instruments: fatheduc
Unadjusted Covariance (Homoskedastic)
Debiased: False
</pre></div></div> </div> <p>The fitted value can be used with OLS to estimate the same parameters. Note that the other values reported such as t-statistics or <span class="math notranslate nohighlight">\(R^2\)</span> are not correct.</p> <p>The <code class="docutils literal notranslate"><span class=pre >compare</span></code> function is used to compare the different models. The 2SLS coefficient on education and the direct coefficient on educ_hat are identical.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >linearmodels.iv</span> <span class=kn >import</span> <span class=n >compare</span>

<span class=n >res_direct</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >wage</span><span class=p >),</span> <span class=n >data</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"educ_hat"</span><span class=p >]],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span>
    <span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span>
<span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >compare</span><span class=p >({</span><span class=s2 >"OLS"</span><span class=p >:</span> <span class=n >res_ols</span><span class=p >,</span> <span class=s2 >"2SLS"</span><span class=p >:</span> <span class=n >res_second</span><span class=p >,</span> <span class=s2 >"Direct"</span><span class=p >:</span> <span class=n >res_direct</span><span class=p >}))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                         Model Comparison
=================================================================
                                OLS           2SLS         Direct
-----------------------------------------------------------------
Dep. Variable                  wage           wage           wage
Estimator                       OLS        IV-2SLS            OLS
No. Observations                428            428            428
Cov. Est.                unadjusted     unadjusted     unadjusted
R-squared                    0.1179         0.0934         0.0060
Adj. R-squared               0.1158         0.0913         0.0037
F-statistic                  57.196         2.8487         2.5982
P-value (F-stat)          3.941e-14         0.0914         0.1070
==================     ============   ============   ============
const                       -0.1852         0.4411         0.4411
                          (-1.0022)       (0.9911)       (0.9465)
educ                         0.1086         0.0592
                           (7.5628)       (1.6878)
educ_hat                                                   0.0592
                                                         (1.6119)
==================== ============== ============== ==============
Instruments                               fatheduc
-----------------------------------------------------------------

T-stats reported in parentheses
</pre></div></div> </div> </section> <section id=Wages-of-Men > <h2 id=Wages-of-Men >Wages of Men<a class=headerlink  href="#Wages-of-Men" title="Permalink to this heading">¶</a></h2> <p>This next example examines the returns to education for men and uses the number of siblings as an instrument.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >linearmodels.datasets</span> <span class=kn >import</span> <span class=n >wage</span>

<span class=n >men</span> <span class=o >=</span> <span class=n >wage</span><span class=o >.</span><span class=n >load</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >wage</span><span class=o >.</span><span class=n >DESCR</span><span class=p >)</span>
<span class=n >men</span> <span class=o >=</span> <span class=n >men</span><span class=p >[[</span><span class=s2 >"educ"</span><span class=p >,</span> <span class=s2 >"wage"</span><span class=p >,</span> <span class=s2 >"sibs"</span><span class=p >,</span> <span class=s2 >"exper"</span><span class=p >]]</span>
<span class=n >men</span> <span class=o >=</span> <span class=n >add_constant</span><span class=p >(</span><span class=n >men</span><span class=p >)</span>
<span class=n >men</span> <span class=o >=</span> <span class=n >men</span><span class=o >.</span><span class=n >dropna</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>

M. Blackburn and D. Neumark (1992), "Unobserved Ability, Efficiency Wages, and
Interindustry Wage Differentials," Quarterly Journal of Economics 107, 1421-1436.

wage                     monthly earnings
hours                    average weekly hours
IQ                       IQ score
KWW                      knowledge of world work score
educ                     years of education
exper                    years of work experience
tenure                   years with current employer
age                      age in years
married                  =1 if married
black                    =1 if black
south                    =1 if live in south
urban                    =1 if live in SMSA
sibs                     number of siblings
brthord                  birth order
meduc                    mother's education
feduc                    father's education
lwage                    natural log of wage

</pre></div></div> </div> <p>OLS estimates indicate a small effect of education for men in this sample.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[7]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res_ols</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >men</span><span class=o >.</span><span class=n >wage</span><span class=p >),</span> <span class=n >men</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"educ"</span><span class=p >]],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span>
    <span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span>
<span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_ols</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:                   wage   R-squared:                      0.0973
Estimator:                        OLS   Adj. R-squared:                 0.0964
No. Observations:                 934   F-statistic:                    100.71
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:36   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          5.9733     0.0814     73.419     0.0000      5.8139      6.1328
educ           0.0598     0.0060     10.035     0.0000      0.0481      0.0715
==============================================================================
</pre></div></div> </div> <p>The first stage regressed the endogenous variable on the instrument. There is a strong, negative relationship here.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res_first</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >men</span><span class=o >.</span><span class=n >educ</span><span class=p >,</span> <span class=n >men</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"sibs"</span><span class=p >]],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span>
    <span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span>
<span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_first</span><span class=o >.</span><span class=n >summary</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:                   educ   R-squared:                      0.0576
Estimator:                        OLS   Adj. R-squared:                 0.0566
No. Observations:                 934   F-statistic:                    57.107
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:36   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          14.143     0.1131     125.02     0.0000      13.921      14.365
sibs          -0.2287     0.0303    -7.5569     0.0000     -0.2880     -0.1694
==============================================================================
</pre></div></div> </div> <p>The second stage indicates a much strong relationship than the OLS estimate.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[9]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >men</span><span class=o >.</span><span class=n >wage</span><span class=p >),</span> <span class=n >men</span><span class=o >.</span><span class=n >const</span><span class=p >,</span> <span class=n >men</span><span class=o >.</span><span class=n >educ</span><span class=p >,</span> <span class=n >men</span><span class=o >.</span><span class=n >sibs</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res</span><span class=o >.</span><span class=n >summary</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                   wage   R-squared:                     -0.0090
Estimator:                    IV-2SLS   Adj. R-squared:                -0.0101
No. Observations:                 934   F-statistic:                    21.715
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:36   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          5.1310     0.3539     14.497     0.0000      4.4373      5.8248
educ           0.1224     0.0263     4.6599     0.0000      0.0709      0.1738
==============================================================================

Endogenous: educ
Instruments: sibs
Unadjusted Covariance (Homoskedastic)
Debiased: False
</pre></div></div> </div> </section> <section id=Weighted-IV > <h2 id=Weighted-IV >Weighted IV<a class=headerlink  href="#Weighted-IV" title="Permalink to this heading">¶</a></h2> <p>All IV estimator support weighted which extends the concept of WLS in an OLS model to IV estimation. The weights are applied to the dependent variables, the matrix of regressors (endogenous and exogenous) and the matrix of instrument (exogenous and instruments) which allows for GLS-type estimation. In particular, if the variance of model residuals was <span class="math notranslate nohighlight">\(\sigma^2_i\)</span>, then setting <span class="math notranslate nohighlight">\(w_i = 1 / \sigma^2_i\)</span> would produce GLS estimates.</p> <p>This example shows how a feasible GLS-type of estimator could be used.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res2</span> <span class=o >=</span> <span class=n >res</span><span class=o >.</span><span class=n >resids</span><span class=o >**</span><span class=mi >2</span>
<span class=n >fgls_mod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >res2</span><span class=p >),</span> <span class=n >men</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"sibs"</span><span class=p >,</span> <span class=s2 >"exper"</span><span class=p >]],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span>
<span class=n >fgls_res</span> <span class=o >=</span> <span class=n >fgls_mod</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >sigma2_hat</span> <span class=o >=</span> <span class=n >np</span><span class=o >.</span><span class=n >exp</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >res2</span><span class=p >)</span> <span class=o >-</span> <span class=n >fgls_res</span><span class=o >.</span><span class=n >resids</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >fgls_res</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:               residual   R-squared:                      0.0045
Estimator:                        OLS   Adj. R-squared:                 0.0024
No. Observations:                 934   F-statistic:                    3.9903
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.1360
Time:                        08:16:36   Distribution:                  chi2(2)
Cov. Estimator:                robust

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const         -2.9315     0.2224    -13.179     0.0000     -3.3675     -2.4956
sibs          -0.0651     0.0335    -1.9452     0.0518     -0.1307      0.0005
exper          0.0084     0.0158     0.5311     0.5953     -0.0226      0.0394
==============================================================================
</pre></div></div> </div> <p>The variance of the squared residuals is not particularly well explained by the data, and so the GLS-type estimates and the usual IV estimates don”t differ by much.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[11]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res_gls</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span>
    <span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >men</span><span class=o >.</span><span class=n >wage</span><span class=p >),</span> <span class=n >men</span><span class=o >.</span><span class=n >const</span><span class=p >,</span> <span class=n >men</span><span class=o >.</span><span class=n >educ</span><span class=p >,</span> <span class=n >men</span><span class=o >.</span><span class=n >sibs</span><span class=p >,</span> <span class=n >weights</span><span class=o >=</span><span class=mi >1</span> <span class=o >/</span> <span class=n >sigma2_hat</span>
<span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_gls</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                   wage   R-squared:                      0.0090
Estimator:                    IV-2SLS   Adj. R-squared:                 0.0080
No. Observations:                 934   F-statistic:                    23.520
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:36   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          5.2031     0.3231     16.105     0.0000      4.5699      5.8363
educ           0.1166     0.0241     4.8497     0.0000      0.0695      0.1638
==============================================================================

Endogenous: educ
Instruments: sibs
Unadjusted Covariance (Homoskedastic)
Debiased: False
</pre></div></div> </div> </section> <section id=Smoking-and-birth-weight > <h2 id=Smoking-and-birth-weight >Smoking and birth weight<a class=headerlink  href="#Smoking-and-birth-weight" title="Permalink to this heading">¶</a></h2> <p>This example examines the effect of smoking on the birth weight of babies.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[12]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >linearmodels.datasets</span> <span class=kn >import</span> <span class=n >birthweight</span>

<span class=n >data</span> <span class=o >=</span> <span class=n >birthweight</span><span class=o >.</span><span class=n >load</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >birthweight</span><span class=o >.</span><span class=n >DESCR</span><span class=p >)</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >add_constant</span><span class=p >(</span><span class=n >data</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>

J. Mullahy (1997), "Instrumental-Variable Estimation of Count Data Models:
Applications to Models of Cigarette Smoking Behavior," Review of Economics
and Statistics 79, 596-593.

faminc                   1988 family income, $1000s
cigtax                   cig. tax in home state, 1988
cigprice                 cig. price in home state, 1988
bwght                    birth weight, ounces
fatheduc                 father's yrs of educ
motheduc                 mother's yrs of educ
parity                   birth order of child
male                     =1 if male child
white                    =1 if white
cigs                     cigs smked per day while preg
lbwght                   log of bwght
bwghtlbs                 birth weight, pounds
packs                    packs smked per day while preg
faminc                   log(faminc)

</pre></div></div> </div> <p>The first stage regresses the number of packs smoked on the cigarette price. There is a very weak relationship – so weak that this is an example of a _weak instrument.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[13]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >packs</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"cigprice"</span><span class=p >]],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span>
    <span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span>
<span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:                  packs   R-squared:                      0.0015
Estimator:                        OLS   Adj. R-squared:                 0.0008
No. Observations:                1388   F-statistic:                    2.0731
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.1499
Time:                        08:16:36   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const         -2.9746     3.2361    -0.9192     0.3580     -9.3172      3.3681
cigprice       0.0356     0.0247     1.4398     0.1499     -0.0129      0.0840
==============================================================================
</pre></div></div> </div> <p>Despite the weak relationship between the price and the number of pack smoked, the 2SLS can be estimated, although substantial caution is warranted to interpret the results. Note the very negative <span class="math notranslate nohighlight">\(R^2\)</span> (-150%).</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[14]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >bwght</span><span class=p >),</span> <span class=n >data</span><span class=o >.</span><span class=n >const</span><span class=p >,</span> <span class=n >data</span><span class=o >.</span><span class=n >packs</span><span class=p >,</span> <span class=n >data</span><span class=o >.</span><span class=n >cigprice</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span>
    <span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span>
<span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                  bwght   R-squared:                     -1.5224
Estimator:                    IV-2SLS   Adj. R-squared:                -1.5242
No. Observations:                1388   F-statistic:                    1.1356
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.2866
Time:                        08:16:36   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          4.7203     0.0381     123.80     0.0000      4.6456      4.7951
packs          0.0238     0.0223     1.0656     0.2866     -0.0199      0.0675
==============================================================================

Endogenous: packs
Instruments: cigprice
Unadjusted Covariance (Homoskedastic)
Debiased: False
</pre></div></div> </div> </section> <section id=Proximity-and-education > <h2 id=Proximity-and-education >Proximity and education<a class=headerlink  href="#Proximity-and-education" title="Permalink to this heading">¶</a></h2> <p>This next example uses a well-known dataset that uses proximity to a 4 year college as an instrument for education.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[15]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >linearmodels.datasets</span> <span class=kn >import</span> <span class=n >card</span>

<span class=n >data</span> <span class=o >=</span> <span class=n >card</span><span class=o >.</span><span class=n >load</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >card</span><span class=o >.</span><span class=n >DESCR</span><span class=p >)</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >add_constant</span><span class=p >(</span><span class=n >data</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>

D. Card (1995), "Using Geographic Variation in College Proximity to Estimate
the Return to Schooling," in Aspects of Labour Market Behavior:  Essays in
Honour of John Vanderkamp.  Ed. L.N. Christophides, E.K. Grant, and R.
Swidinsky, 201-222.  Toronto: University of Toronto Press.

id                       person identifier
nearc2                   =1 if near 2 yr college, 1966
nearc4                   =1 if near 4 yr college, 1966
educ                     years of schooling, 1976
age                      in years
fatheduc                 father's schooling
motheduc                 mother's schooling
weight                   NLS sampling weight, 1976
momdad14                 =1 if live with mom, dad at 14
sinmom14                 =1 if with single mom at 14
step14                   =1 if with step parent at 14
reg661                   =1 for region 1, 1966
reg662                   =1 for region 2, 1966
reg663                   =1 for region 3, 1966
reg664                   =1 for region 4, 1966
reg665                   =1 for region 5, 1966
reg666                   =1 for region 6, 1966
reg667                   =1 for region 7, 1966
reg668                   =1 for region 8, 1966
reg669                   =1 for region 9, 1966
south66                  =1 if in south in 1966
black                    =1 if black
smsa                     =1 in in SMSA, 1976
south                    =1 if in south, 1976
smsa66                   =1 if in SMSA, 1966
wage                     hourly wage in cents, 1976
enroll                   =1 if enrolled in school, 1976
KWW                      knowledge world of work score
IQ                       IQ score
married                  =1 if married, 1976
libcrd14                 =1 if lib. card in home at 14
exper                    age - educ - 6
lwage                    log(wage)
xpersq                   exper**2

</pre></div></div> </div> <p>Lists are used to hold the groups of variable in this large model and missing values are dropped.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[16]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >dep</span> <span class=o >=</span> <span class=p >[</span><span class=s2 >"wage"</span><span class=p >]</span>
<span class=n >endog</span> <span class=o >=</span> <span class=p >[</span><span class=s2 >"educ"</span><span class=p >]</span>
<span class=n >exog</span> <span class=o >=</span> <span class=p >[</span>
    <span class=s2 >"const"</span><span class=p >,</span>
    <span class=s2 >"exper"</span><span class=p >,</span>
    <span class=s2 >"expersq"</span><span class=p >,</span>
    <span class=s2 >"black"</span><span class=p >,</span>
    <span class=s2 >"smsa"</span><span class=p >,</span>
    <span class=s2 >"south"</span><span class=p >,</span>
    <span class=s2 >"smsa66"</span><span class=p >,</span>
    <span class=s2 >"reg662"</span><span class=p >,</span>
    <span class=s2 >"reg663"</span><span class=p >,</span>
    <span class=s2 >"reg664"</span><span class=p >,</span>
    <span class=s2 >"reg665"</span><span class=p >,</span>
    <span class=s2 >"reg666"</span><span class=p >,</span>
    <span class=s2 >"reg667"</span><span class=p >,</span>
    <span class=s2 >"reg668"</span><span class=p >,</span>
    <span class=s2 >"reg669"</span><span class=p >,</span>
<span class=p >]</span>
<span class=n >instr</span> <span class=o >=</span> <span class=p >[</span><span class=s2 >"nearc4"</span><span class=p >]</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >data</span><span class=p >[</span><span class=n >dep</span> <span class=o >+</span> <span class=n >exog</span> <span class=o >+</span> <span class=n >endog</span> <span class=o >+</span> <span class=n >instr</span><span class=p >]</span><span class=o >.</span><span class=n >dropna</span><span class=p >()</span>
</pre></div> </div> </div> <p>The first stage estimate shows a very large F-statistic. Note that when there are many exogenous variables the results cannot be directly interpreted. It is better to use the <code class="docutils literal notranslate"><span class=pre >first_stage</span></code> information from a 2SLS estimate.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[17]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >educ</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >instr</span> <span class=o >+</span> <span class=n >exog</span><span class=p >],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:                   educ   R-squared:                      0.4771
Estimator:                        OLS   Adj. R-squared:                 0.4745
No. Observations:                3010   F-statistic:                    3693.4
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:36   Distribution:                 chi2(15)
Cov. Estimator:                robust

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
nearc4         0.3199     0.0848     3.7702     0.0002      0.1536      0.4862
const          16.638     0.2148     77.456     0.0000      16.217      17.059
exper         -0.4125     0.0320    -12.896     0.0000     -0.4752     -0.3498
expersq        0.0009     0.0017     0.5100     0.6100     -0.0025      0.0042
black         -0.9355     0.0923    -10.138     0.0000     -1.1164     -0.7547
smsa           0.4022     0.1109     3.6255     0.0003      0.1848      0.6196
south         -0.0516     0.1416    -0.3645     0.7155     -0.3291      0.2259
smsa66         0.0255     0.1103     0.2309     0.8174     -0.1908      0.2417
reg662        -0.0786     0.1854    -0.4242     0.6714     -0.4420      0.2847
reg663        -0.0279     0.1789    -0.1562     0.8759     -0.3785      0.3226
reg664         0.1172     0.2070     0.5660     0.5714     -0.2886      0.5230
reg665        -0.2726     0.2237    -1.2186     0.2230     -0.7111      0.1659
reg666        -0.3028     0.2361    -1.2826     0.1996     -0.7656      0.1599
reg667        -0.2168     0.2389    -0.9077     0.3640     -0.6850      0.2513
reg668         0.5239     0.2562     2.0449     0.0409      0.0218      1.0260
reg669         0.2103     0.1988     1.0575     0.2903     -0.1794      0.6000
==============================================================================
</pre></div></div> </div> <p>The OLS estimate indicates an increase of 7% for a year of education.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[18]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >wage</span><span class=p >),</span> <span class=n >data</span><span class=p >[</span><span class=n >exog</span> <span class=o >+</span> <span class=n >endog</span><span class=p >],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:                   wage   R-squared:                      0.2998
Estimator:                        OLS   Adj. R-squared:                 0.2963
No. Observations:                3010   F-statistic:                    1377.0
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:36   Distribution:                 chi2(15)
Cov. Estimator:                robust

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          4.6208     0.0740     62.417     0.0000      4.4757      4.7659
exper          0.0848     0.0067     12.592     0.0000      0.0716      0.0980
expersq       -0.0023     0.0003    -7.1798     0.0000     -0.0029     -0.0017
black         -0.1990     0.0181    -10.985     0.0000     -0.2345     -0.1635
smsa           0.1364     0.0192     7.1159     0.0000      0.0988      0.1739
south         -0.1480     0.0280    -5.2917     0.0000     -0.2028     -0.0932
smsa66         0.0262     0.0185     1.4153     0.1570     -0.0101      0.0626
reg662         0.0964     0.0350     2.7531     0.0059      0.0278      0.1650
reg663         0.1445     0.0337     4.2850     0.0000      0.0784      0.2107
reg664         0.0551     0.0411     1.3402     0.1802     -0.0255      0.1356
reg665         0.1280     0.0428     2.9912     0.0028      0.0441      0.2119
reg666         0.1405     0.0450     3.1223     0.0018      0.0523      0.2287
reg667         0.1180     0.0455     2.5934     0.0095      0.0288      0.2071
reg668        -0.0564     0.0505    -1.1183     0.2634     -0.1553      0.0425
reg669         0.1186     0.0387     3.0658     0.0022      0.0428      0.1944
educ           0.0747     0.0036     20.540     0.0000      0.0676      0.0818
==============================================================================
</pre></div></div> </div> <p>The 2SLS estimate of the effect is nearly double. However, there is some reason to be concerned about the strength of the instrument despite the F-statistic in the first stage regression.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[19]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res_2sls</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >wage</span><span class=p >),</span> <span class=n >data</span><span class=p >[</span><span class=n >exog</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >endog</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >instr</span><span class=p >])</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_2sls</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                   wage   R-squared:                      0.2382
Estimator:                    IV-2SLS   Adj. R-squared:                 0.2343
No. Observations:                3010   F-statistic:                    840.83
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:36   Distribution:                 chi2(15)
Cov. Estimator:                robust

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          3.6662     0.9085     4.0352     0.0001      1.8855      5.4468
exper          0.1083     0.0233     4.6376     0.0000      0.0625      0.1540
expersq       -0.0023     0.0003    -6.7128     0.0000     -0.0030     -0.0017
black         -0.1468     0.0524    -2.8031     0.0051     -0.2494     -0.0441
smsa           0.1118     0.0311     3.5995     0.0003      0.0509      0.1727
south         -0.1447     0.0291    -4.9775     0.0000     -0.2016     -0.0877
smsa66         0.0185     0.0205     0.9035     0.3663     -0.0217      0.0587
reg662         0.1008     0.0365     2.7644     0.0057      0.0293      0.1722
reg663         0.1483     0.0355     4.1760     0.0000      0.0787      0.2178
reg664         0.0499     0.0435     1.1471     0.2514     -0.0354      0.1352
reg665         0.1463     0.0491     2.9794     0.0029      0.0500      0.2425
reg666         0.1629     0.0516     3.1553     0.0016      0.0617      0.2641
reg667         0.1346     0.0504     2.6689     0.0076      0.0357      0.2334
reg668        -0.0831     0.0571    -1.4552     0.1456     -0.1950      0.0288
reg669         0.1078     0.0410     2.6317     0.0085      0.0275      0.1881
educ           0.1315     0.0540     2.4353     0.0149      0.0257      0.2373
==============================================================================

Endogenous: educ
Instruments: nearc4
Robust Covariance (Heteroskedastic)
Debiased: False
</pre></div></div> </div> <p>The property <code class="docutils literal notranslate"><span class=pre >first_stage</span></code> can be used to show a large set of first stage diagnostics. These results show a much lower <em>partial</em> <span class="math notranslate nohighlight">\(R^2\)</span> that has measures the unique effect of the instrument on the endogenous controlling for the exogenous regressors. This is much smaller than the naive first stage <span class="math notranslate nohighlight">\(R^2\)</span> of 47%. The partial F-statistic is also much smaller, although it technically over the rule-of-thumb of 10 for a single instrument.</p> <p>The instrument is a dummy variable and being close to a 4 year college is only worth 0.3 years of education on average.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[20]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=nb >print</span><span class=p >(</span><span class=n >res_2sls</span><span class=o >.</span><span class=n >first_stage</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
    First Stage Estimation Results
======================================
                                  educ
--------------------------------------
R-squared                       0.4771
Partial R-squared               0.0044
Shea's R-squared                0.0044
Partial F-statistic             14.214
P-value (Partial F-stat)        0.0002
Partial F-stat Distn           chi2(1)
========================== ===========
const                           16.638
                              (77.456)
exper                          -0.4125
                             (-12.896)
expersq                         0.0009
                              (0.5100)
black                          -0.9355
                             (-10.138)
smsa                            0.4022
                              (3.6255)
south                          -0.0516
                             (-0.3645)
smsa66                          0.0255
                              (0.2309)
reg662                         -0.0786
                             (-0.4242)
reg663                         -0.0279
                             (-0.1562)
reg664                          0.1172
                              (0.5660)
reg665                         -0.2726
                             (-1.2186)
reg666                         -0.3028
                             (-1.2826)
reg667                         -0.2168
                             (-0.9077)
reg668                          0.5239
                              (2.0449)
reg669                          0.2103
                              (1.0575)
nearc4                          0.3199
                              (3.7702)
--------------------------------------

T-stats reported in parentheses
T-stats use same covariance type as original model
</pre></div></div> </div> </section> <section id=Formula-interface > <h2 id=Formula-interface >Formula interface<a class=headerlink  href="#Formula-interface" title="Permalink to this heading">¶</a></h2> <p>This model was large and so it might be simpler to use a formula. While formulas are discussed in <a class="reference internal" href=using-formulas.html ><span class=doc >detail in another notebook</span></a>, they use the formula language of <a class="reference external" href="https://matthewwardrop.github.io/formulaic/">formulaic</a> with an augmentation to specify the endogenous and instrumental variables. The generic form is</p> <div class="highlight-none notranslate"><div class=highlight ><pre><span></span>dependent ~ exog + [endog ~ instr]
</pre></div> </div> <p>where each block can contain multiple variables.</p> <p>Here the model is compared to the direct parameterization using DataFrames by differencing the <span class="math notranslate nohighlight">\(R^2\)</span>.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[21]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >import</span> <span class=nn >numpy</span> <span class=k >as</span> <span class=nn >np</span>

<span class=n >formula</span> <span class=o >=</span> <span class=p >(</span>
    <span class=s2 >"np.log(wage) ~ 1 + exper + expersq + black + smsa + south + smsa66 + reg662 + reg663 + reg664 + "</span>
    <span class=s2 >"reg665 + reg666 + reg667 + reg668 + reg669 + [educ ~ nearc4]"</span>
<span class=p >)</span>
<span class=n >mod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=o >.</span><span class=n >from_formula</span><span class=p >(</span><span class=n >formula</span><span class=p >,</span> <span class=n >data</span><span class=p >)</span>
<span class=n >res_formula</span> <span class=o >=</span> <span class=n >mod</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_formula</span><span class=o >.</span><span class=n >rsquared</span> <span class=o >-</span> <span class=n >res_2sls</span><span class=o >.</span><span class=n >rsquared</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
-3.949285343196607e-12
</pre></div></div> </div> </section> <section id=Categorical-Variables > <h2 id=Categorical-Variables >Categorical Variables<a class=headerlink  href="#Categorical-Variables" title="Permalink to this heading">¶</a></h2> <p>pandas <code class="docutils literal notranslate"><span class=pre >categorical</span></code>s are automatically treated as factors and expanded to dummies. The first is always dropped. This next block constructs a categorical from the region dummies and then uses it instead of the individual dummies. The model is identical.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[22]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >data</span><span class=p >[</span><span class=s2 >"reg"</span><span class=p >]</span> <span class=o >=</span> <span class=s2 >"661"</span>  <span class=c1 ># The default region, which was omitted</span>
<span class=k >for</span> <span class=n >i</span> <span class=ow >in</span> <span class=nb >range</span><span class=p >(</span><span class=mi >2</span><span class=p >,</span> <span class=mi >10</span><span class=p >):</span>
    <span class=n >region</span> <span class=o >=</span> <span class=s2 >"reg66"</span> <span class=o >+</span> <span class=nb >str</span><span class=p >(</span><span class=n >i</span><span class=p >)</span>
    <span class=n >data</span><span class=o >.</span><span class=n >loc</span><span class=p >[</span><span class=n >data</span><span class=p >[</span><span class=n >region</span><span class=p >]</span> <span class=o >==</span> <span class=mi >1</span><span class=p >,</span> <span class=s2 >"reg"</span><span class=p >]</span> <span class=o >=</span> <span class=n >region</span><span class=p >[</span><span class=mi >3</span><span class=p >:]</span>
<span class=n >data</span><span class=p >[</span><span class=s2 >"reg"</span><span class=p >]</span> <span class=o >=</span> <span class=n >data</span><span class=p >[</span><span class=s2 >"reg"</span><span class=p >]</span><span class=o >.</span><span class=n >astype</span><span class=p >(</span><span class=s2 >"category"</span><span class=p >)</span>
<span class=n >data</span><span class=o >.</span><span class=n >describe</span><span class=p >()</span>
<span class=n >res_cat</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span>
    <span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >wage</span><span class=p >),</span>
    <span class=n >data</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"exper"</span><span class=p >,</span> <span class=s2 >"expersq"</span><span class=p >,</span> <span class=s2 >"black"</span><span class=p >,</span> <span class=s2 >"smsa"</span><span class=p >,</span> <span class=s2 >"south"</span><span class=p >,</span> <span class=s2 >"smsa66"</span><span class=p >,</span> <span class=s2 >"reg"</span><span class=p >]],</span>
    <span class=n >data</span><span class=o >.</span><span class=n >educ</span><span class=p >,</span>
    <span class=n >data</span><span class=o >.</span><span class=n >nearc4</span><span class=p >,</span>
<span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_cat</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                   wage   R-squared:                      0.2382
Estimator:                    IV-2SLS   Adj. R-squared:                 0.2343
No. Observations:                3010   F-statistic:                    840.83
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:37   Distribution:                 chi2(15)
Cov. Estimator:                robust

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          3.6662     0.9085     4.0352     0.0001      1.8855      5.4468
exper          0.1083     0.0233     4.6376     0.0000      0.0625      0.1540
expersq       -0.0023     0.0003    -6.7128     0.0000     -0.0030     -0.0017
black         -0.1468     0.0524    -2.8031     0.0051     -0.2494     -0.0441
smsa           0.1118     0.0311     3.5995     0.0003      0.0509      0.1727
south         -0.1447     0.0291    -4.9775     0.0000     -0.2016     -0.0877
smsa66         0.0185     0.0205     0.9035     0.3663     -0.0217      0.0587
reg.662        0.1008     0.0365     2.7644     0.0057      0.0293      0.1722
reg.663        0.1483     0.0355     4.1760     0.0000      0.0787      0.2178
reg.664        0.0499     0.0435     1.1471     0.2514     -0.0354      0.1352
reg.665        0.1463     0.0491     2.9794     0.0029      0.0500      0.2425
reg.666        0.1629     0.0516     3.1553     0.0016      0.0617      0.2641
reg.667        0.1346     0.0504     2.6689     0.0076      0.0357      0.2334
reg.668       -0.0831     0.0571    -1.4552     0.1456     -0.1950      0.0288
reg.669        0.1078     0.0410     2.6317     0.0085      0.0275      0.1881
educ           0.1315     0.0540     2.4353     0.0149      0.0257      0.2373
==============================================================================

Endogenous: educ
Instruments: nearc4
Robust Covariance (Heteroskedastic)
Debiased: False
</pre></div></div> </div> </section> <section id=Post-estimation-diagnostics > <h2 id=Post-estimation-diagnostics >Post-estimation diagnostics<a class=headerlink  href="#Post-estimation-diagnostics" title="Permalink to this heading">¶</a></h2> <p>Common post-estimation diagnostics are to test the assumption of endogeneity and to examine if instruments are valid (when there are more instruments than endogenous variables).</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[23]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >data</span> <span class=o >=</span> <span class=n >mroz</span><span class=o >.</span><span class=n >load</span><span class=p >()</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >data</span><span class=o >.</span><span class=n >dropna</span><span class=p >()</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >add_constant</span><span class=p >(</span><span class=n >data</span><span class=p >,</span> <span class=n >has_constant</span><span class=o >=</span><span class=s2 >"add"</span><span class=p >)</span>
<span class=n >data</span><span class=p >[</span><span class=s2 >"lnwage"</span><span class=p >]</span> <span class=o >=</span> <span class=n >np</span><span class=o >.</span><span class=n >log</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >wage</span><span class=p >)</span>
<span class=n >dep</span> <span class=o >=</span> <span class=s2 >"lnwage"</span>
<span class=n >exog</span> <span class=o >=</span> <span class=p >[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"exper"</span><span class=p >,</span> <span class=s2 >"expersq"</span><span class=p >]</span>
<span class=n >endog</span> <span class=o >=</span> <span class=p >[</span><span class=s2 >"educ"</span><span class=p >]</span>
<span class=n >instr</span> <span class=o >=</span> <span class=p >[</span><span class=s2 >"fatheduc"</span><span class=p >,</span> <span class=s2 >"motheduc"</span><span class=p >]</span>
</pre></div> </div> </div> <p>The first step is to fit the model using 2SLS.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[24]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=p >[</span><span class=n >dep</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >exog</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >endog</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >instr</span><span class=p >])</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                 lnwage   R-squared:                      0.1357
Estimator:                    IV-2SLS   Adj. R-squared:                 0.1296
No. Observations:                 428   F-statistic:                    24.653
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:37   Distribution:                  chi2(3)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          0.0481     0.3985     0.1207     0.9039     -0.7329      0.8291
exper          0.0442     0.0134     3.3038     0.0010      0.0180      0.0704
expersq       -0.0009     0.0004    -2.2485     0.0245     -0.0017     -0.0001
educ           0.0614     0.0313     1.9622     0.0497   7.043e-05      0.1227
==============================================================================

Endogenous: educ
Instruments: fatheduc, motheduc
Unadjusted Covariance (Homoskedastic)
Debiased: False
</pre></div></div> </div> <p>Wooldridge”s regression test of exogeneity uses regression residual where the endogenous variables are regressed on the exogenous and the instrument to test for endogeneity. IF the endogenous variable is actually exogenous these residuals should not be correlated with the variable of interest.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[25]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span><span class=o >.</span><span class=n >wooldridge_regression</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[25]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Wooldridge's regression test of exogeneity
H0: Endogenous variables are exogenous
Statistic: 2.8256
P-value: 0.0928
Distributed: chi2(1)
WaldTestStatistic, id: 0x7f71057e93d0
</pre></div></div> </div> <p>This test can be easily implemented using two regression. The first one constructs the residuals and the second re-fits the model using 2SLS but including the residuals.</p> <p>Note that the p-value of the t-state on <code class="docutils literal notranslate"><span class=pre >residuals</span></code> is the same as the P-value of the previous test – this is not an accident.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[26]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >v</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=p >[</span><span class=n >endog</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >exog</span> <span class=o >+</span> <span class=n >instr</span><span class=p >],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span><span class=o >.</span><span class=n >resids</span>
<span class=kn >import</span> <span class=nn >pandas</span> <span class=k >as</span> <span class=nn >pd</span>

<span class=n >res_direct</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span>
    <span class=n >data</span><span class=p >[</span><span class=n >dep</span><span class=p >],</span> <span class=n >pd</span><span class=o >.</span><span class=n >concat</span><span class=p >([</span><span class=n >v</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >exog</span><span class=p >]],</span> <span class=mi >1</span><span class=p >),</span> <span class=n >data</span><span class=p >[</span><span class=n >endog</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >instr</span><span class=p >]</span>
<span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_direct</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                 lnwage   R-squared:                      0.1624
Estimator:                    IV-2SLS   Adj. R-squared:                 0.1544
No. Observations:                 428   F-statistic:                    82.954
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:37   Distribution:                  chi2(4)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
residual       0.0582     0.0346     1.6810     0.0928     -0.0097      0.1260
const          0.0481     0.3923     0.1226     0.9024     -0.7207      0.8169
exper          0.0442     0.0132     3.3559     0.0008      0.0184      0.0700
expersq       -0.0009     0.0004    -2.2840     0.0224     -0.0017     -0.0001
educ           0.0614     0.0308     1.9932     0.0462      0.0010      0.1218
==============================================================================

Endogenous: educ
Instruments: fatheduc, motheduc
Unadjusted Covariance (Homoskedastic)
Debiased: False
</pre></div></div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/tmp/ipykernel_4206/309156546.py:5: FutureWarning: In a future version of pandas all arguments of concat except for the argument 'objs' will be keyword-only.
  data[dep], pd.concat([v, data[exog]], 1), data[endog], data[instr]
</pre></div></div> </div> <p>Since this regression has two instrument it is possible to test for overidentification. Wooldridge”s overidentification test uses a regression to test whether the 2SLS residuals are uncorrelated with the instruments, which should be the case if the model is correct and the instruments are not needed in the original model.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[27]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span><span class=o >.</span><span class=n >wooldridge_overid</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[27]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Wooldridge's score test of overidentification
H0: Model is not overidentified.
Statistic: 0.4435
P-value: 0.5055
Distributed: chi2(1)
WaldTestStatistic, id: 0x7f71057db910
</pre></div></div> </div> <p>A naive version of this test can be directly implemented. This direct implementation is different from the formal test but would be consistent if the model was overidentified.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[28]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >u</span> <span class=o >=</span> <span class=n >res</span><span class=o >.</span><span class=n >resids</span>
<span class=n >res</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >u</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s2 >"exper"</span><span class=p >,</span> <span class=s2 >"expersq"</span><span class=p >]</span> <span class=o >+</span> <span class=n >instr</span><span class=p >],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
</pre></div> </div> </div> <p>The test is <span class="math notranslate nohighlight">\(n\times R^2\)</span>, and has the same <span class="math notranslate nohighlight">\(\chi^2_1\)</span> distribution. The test statistic is slightly smaller but the conclusions are the same.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[29]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span><span class=o >.</span><span class=n >nobs</span> <span class=o >*</span> <span class=n >res</span><span class=o >.</span><span class=n >rsquared</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[29]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
0.37198111061488515
</pre></div></div> </div> <p>Husband”s education can be used as an additional instrument, and its validity tested.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[30]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >instr</span> <span class=o >=</span> <span class=p >[</span><span class=s2 >"fatheduc"</span><span class=p >,</span> <span class=s2 >"motheduc"</span><span class=p >,</span> <span class=s2 >"huseduc"</span><span class=p >]</span>
<span class=n >res</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=p >[</span><span class=n >dep</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >exog</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >endog</span><span class=p >],</span> <span class=n >data</span><span class=p >[</span><span class=n >instr</span><span class=p >])</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >)</span>
</pre></div> </div> </div> <p>Testing overidentification does not indicate any difference from the previous result.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[31]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res</span><span class=o >.</span><span class=n >wooldridge_overid</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[31]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Wooldridge's score test of overidentification
H0: Model is not overidentified.
Statistic: 1.0421
P-value: 0.5939
Distributed: chi2(2)
WaldTestStatistic, id: 0x7f7105a53d90
</pre></div></div> </div> <p>Directly testing using two regression would reach the same conclusion.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[32]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >u</span> <span class=o >=</span> <span class=n >res</span><span class=o >.</span><span class=n >resids</span>
<span class=n >res</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >u</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s2 >"exper"</span><span class=p >,</span> <span class=s2 >"expersq"</span><span class=p >]</span> <span class=o >+</span> <span class=n >instr</span><span class=p >],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >res</span><span class=o >.</span><span class=n >nobs</span> <span class=o >*</span> <span class=n >res</span><span class=o >.</span><span class=n >rsquared</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[32]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
1.1126588681971414
</pre></div></div> </div> </section> <section id=Panel-IV > <h2 id=Panel-IV >Panel IV<a class=headerlink  href="#Panel-IV" title="Permalink to this heading">¶</a></h2> <p>Instrumental variable regression can also be used with panel data. This example makes use of first differences to eliminate a year-specific effect and then uses</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[33]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=kn >from</span> <span class=nn >linearmodels.datasets</span> <span class=kn >import</span> <span class=n >jobtraining</span>

<span class=n >data</span> <span class=o >=</span> <span class=n >jobtraining</span><span class=o >.</span><span class=n >load</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >jobtraining</span><span class=o >.</span><span class=n >DESCR</span><span class=p >)</span>
<span class=n >data</span><span class=o >.</span><span class=n >head</span><span class=p >()</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >data</span><span class=o >.</span><span class=n >where</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >year</span><span class=o >.</span><span class=n >isin</span><span class=p >((</span><span class=mi >1987</span><span class=p >,</span> <span class=mi >1988</span><span class=p >)))</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >data</span><span class=o >.</span><span class=n >dropna</span><span class=p >(</span><span class=n >how</span><span class=o >=</span><span class=s2 >"all"</span><span class=p >,</span> <span class=n >axis</span><span class=o >=</span><span class=mi >0</span><span class=p >)</span><span class=o >.</span><span class=n >sort_values</span><span class=p >([</span><span class=s2 >"fcode"</span><span class=p >,</span> <span class=s2 >"year"</span><span class=p >])</span>
<span class=nb >print</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >describe</span><span class=p >())</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >data</span><span class=o >.</span><span class=n >set_index</span><span class=p >(</span><span class=s2 >"fcode"</span><span class=p >)</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >data</span><span class=p >[[</span><span class=s2 >"year"</span><span class=p >,</span> <span class=s2 >"hrsemp"</span><span class=p >,</span> <span class=s2 >"grant"</span><span class=p >,</span> <span class=s2 >"scrap"</span><span class=p >,</span> <span class=s2 >"lscrap"</span><span class=p >]]</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>

H. Holzer, R. Block, M. Cheatham, and J. Knott (1993), "Are Training Subsidies
Effective? The Michigan Experience," Industrial and Labor Relations Review 46,
625-636.

year                     1987, 1988, or 1989
fcode                    firm code number
employ                   # employees at plant
sales                    annual sales, $
avgsal                   average employee salary
scrap                    scrap rate (per 100 items)
rework                   rework rate (per 100 items)
tothrs                   total hours training
union                    =1 if unionized
grant                    =1 if received grant
d89                      =1 if year = 1989
d88                      =1 if year = 1988
totrain                  total employees trained
hrsemp                   tothrs/totrain
lscrap                   log(scrap)
lemploy                  log(employ)
lsales                   log(sales)
lrework                  log(rework)
lhrsemp                  log(1 + hrsemp)
lscrap_1                 lagged lscrap; missing 1987
grant_1                  lagged grant; assumed 0 in 1987
clscrap                  lscrap - lscrap_1; year &gt; 1987
cgrant                   grant - grant_1
clemploy                 lemploy - lemploy[t-1]
clsales                  lavgsal - lavgsal[t-1]
lavgsal                  log(avgsal)
clavgsal                 lavgsal - lavgsal[t-1]
cgrant_1                 cgrant[t-1]
chrsemp                  hrsemp - hrsemp[t-1]
lhrsemp                 lhrsemp - lhrsemp[t-1]

              year          fcode      employ         sales        avgsal  \
count   314.000000     314.000000  290.000000  2.450000e+02    267.000000
mean   1987.500000  415708.885350   56.903448  5.679815e+06  18326.284644
std       0.500798    4025.063452   70.843101  6.977975e+06   6507.584305
min    1987.000000  410032.000000    4.000000  1.100000e+05   4237.000000
25%    1987.000000  410604.000000   15.000000  1.527000e+06  13664.000000
50%    1987.500000  418084.000000   27.500000  2.900000e+06  17160.000000
75%    1988.000000  419309.000000   70.000000  7.000000e+06  22000.000000
max    1988.000000  419486.000000  500.000000  4.700000e+07  40563.000000

            scrap     rework      tothrs       union       grant  ...  \
count  108.000000  82.000000  276.000000  314.000000  314.000000  ...
mean     4.199722   3.883537   25.648551    0.197452    0.114650  ...
std      6.188094   6.145294   45.694834    0.398712    0.319107  ...
min      0.010000   0.000000    0.000000    0.000000    0.000000  ...
25%      0.767500   0.332500    0.000000    0.000000    0.000000  ...
50%      1.555000   1.500000    8.000000    0.000000    0.000000  ...
75%      5.000000   4.267500   39.250000    0.000000    0.000000  ...
max     30.000000  40.000000  290.000000    1.000000    1.000000  ...

       grant_1    clscrap      cgrant    clemploy     clsales     lavgsal  \
count    314.0  54.000000  314.000000  144.000000  119.000000  267.000000
mean       0.0  -0.168993    0.114650    0.096876    0.128995    9.754753
std        0.0   0.589774    0.319107    0.251180    0.489422    0.353818
min        0.0  -2.502170    0.000000   -0.411099   -1.982874    8.351611
25%        0.0  -0.350983    0.000000   -0.031946    0.023286    9.522509
50%        0.0  -0.115118    0.000000    0.064538    0.116219    9.750337
75%        0.0   0.092537    0.000000    0.182321    0.215391    9.998797
max        0.0   2.397895    1.000000    1.673976    2.896701   10.610610

         clavgsal  cgrant_1     chrsemp    clhrsemp
count  131.000000     157.0  125.000000  125.000000
mean     0.058601       0.0    7.423050    0.642580
std      0.074255       0.0   19.301290    1.235229
min     -0.080411       0.0  -47.753490   -2.338574
25%      0.020135       0.0    0.000000    0.000000
50%      0.057159       0.0    0.272727    0.039375
75%      0.086255       0.0   10.000000    1.063067
max      0.568912       0.0  107.027800    4.394449

[8 rows x 30 columns]
</pre></div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[34]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >deltas</span> <span class=o >=</span> <span class=n >data</span><span class=o >.</span><span class=n >loc</span><span class=p >[</span><span class=n >data</span><span class=o >.</span><span class=n >year</span> <span class=o >==</span> <span class=mi >1988</span><span class=p >]</span> <span class=o >-</span> <span class=n >data</span><span class=o >.</span><span class=n >loc</span><span class=p >[</span><span class=n >data</span><span class=o >.</span><span class=n >year</span> <span class=o >==</span> <span class=mi >1987</span><span class=p >]</span>
<span class=n >deltas</span> <span class=o >=</span> <span class=n >add_constant</span><span class=p >(</span><span class=n >deltas</span><span class=p >,</span> <span class=n >has_constant</span><span class=o >=</span><span class=s2 >"add"</span><span class=p >)</span>
<span class=n >deltas</span> <span class=o >=</span> <span class=n >deltas</span><span class=o >.</span><span class=n >dropna</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >deltas</span><span class=o >.</span><span class=n >describe</span><span class=p >())</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
       const  year     hrsemp      grant      scrap     lscrap
count   45.0  45.0  45.000000  45.000000  45.000000  45.000000
mean     1.0   1.0  10.812321   0.377778  -0.817556  -0.185697
std      0.0   0.0  20.523825   0.490310   2.496392   0.626858
min      1.0   1.0 -19.850180   0.000000 -10.000000  -2.502169
25%      1.0   1.0   0.000000   0.000000  -1.000000  -0.355820
50%      1.0   1.0   1.846154   0.000000  -0.110000  -0.167054
75%      1.0   1.0  15.333330   1.000000   0.090000   0.054067
max      1.0   1.0  80.000000   1.000000   5.000000   2.397895
</pre></div></div> </div> <p>The first stage indicates a relatively strong relationship between grant and the number of hours employed. Note that grant is a dummy and so the coefficient is just the difference in means.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[35]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >mod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >deltas</span><span class=o >.</span><span class=n >hrsemp</span><span class=p >,</span> <span class=n >deltas</span><span class=p >[[</span><span class=s2 >"const"</span><span class=p >,</span> <span class=s2 >"grant"</span><span class=p >]],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >mod</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:                 hrsemp   R-squared:                      0.3408
Estimator:                        OLS   Adj. R-squared:                 0.3255
No. Observations:                  45   F-statistic:                    23.266
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0000
Time:                        08:16:37   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          1.5806     3.1139     0.5076     0.6117     -4.5225      7.6837
grant          24.437     5.0662     4.8235     0.0000      14.507      34.367
==============================================================================
</pre></div></div> </div> <p>Here a formula is used to specify the model since it is cleaner. Note that the <code class="docutils literal notranslate"><span class=pre >[]</span></code> contains the endogenous variables and instruments.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[36]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >mod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=o >.</span><span class=n >from_formula</span><span class=p >(</span><span class=s2 >"lscrap ~ 1 + [hrsemp ~ grant]"</span><span class=p >,</span> <span class=n >deltas</span><span class=p >)</span>
<span class=n >res_iv</span> <span class=o >=</span> <span class=n >mod</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_iv</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                 lscrap   R-squared:                      0.0159
Estimator:                    IV-2SLS   Adj. R-squared:                -0.0070
No. Observations:                  45   F-statistic:                    3.3464
Date:                Tue, Oct 11 2022   P-value (F-stat)                0.0674
Time:                        08:16:37   Distribution:                  chi2(1)
Cov. Estimator:            unadjusted

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
Intercept     -0.0327     0.1241    -0.2632     0.7924     -0.2759      0.2106
hrsemp        -0.0142     0.0077    -1.8293     0.0674     -0.0293      0.0010
==============================================================================

Endogenous: hrsemp
Instruments: grant
Unadjusted Covariance (Homoskedastic)
Debiased: False
</pre></div></div> </div> <p>The 2SLS estimate is nearly twice as large as the OLS estimate and is slightly more significant.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[37]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >res_ols</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=o >.</span><span class=n >from_formula</span><span class=p >(</span><span class=s2 >"lscrap ~ 1 + hrsemp"</span><span class=p >,</span> <span class=n >deltas</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >compare</span><span class=p >({</span><span class=s2 >"Panel OLS"</span><span class=p >:</span> <span class=n >res_ols</span><span class=p >,</span> <span class=s2 >"Panel IV"</span><span class=p >:</span> <span class=n >res_iv</span><span class=p >}))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                 Model Comparison
==================================================
                          Panel OLS       Panel IV
--------------------------------------------------
Dep. Variable                lscrap         lscrap
Estimator                       OLS        IV-2SLS
No. Observations                 45             45
Cov. Est.                unadjusted     unadjusted
R-squared                    0.0619         0.0159
Adj. R-squared               0.0401        -0.0070
F-statistic                  2.9707         3.3464
P-value (F-stat)             0.0848         0.0674
==================     ============   ============
Intercept                   -0.1035        -0.0327
                          (-1.0208)      (-0.2632)
hrsemp                      -0.0076        -0.0142
                          (-1.7236)      (-1.8293)
==================== ============== ==============
Instruments                                  grant
--------------------------------------------------

T-stats reported in parentheses
</pre></div></div> </div> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[38]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre><span></span><span class=n >mod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=o >.</span><span class=n >from_formula</span><span class=p >(</span><span class=s2 >"lscrap ~ 1 + [hrsemp ~ grant]"</span><span class=p >,</span> <span class=n >deltas</span><span class=p >)</span>
<span class=n >res_iv</span> <span class=o >=</span> <span class=n >mod</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s2 >"unadjusted"</span><span class=p >)</span>
<span class=n >n</span> <span class=o >=</span> <span class=n >deltas</span><span class=o >.</span><span class=n >shape</span><span class=p >[</span><span class=mi >0</span><span class=p >]</span>
<span class=n >res_iv</span><span class=o >.</span><span class=n >predict</span><span class=p >(</span><span class=n >exog</span><span class=o >=</span><span class=n >np</span><span class=o >.</span><span class=n >ones</span><span class=p >((</span><span class=n >n</span><span class=p >,</span> <span class=mi >1</span><span class=p >)),</span> <span class=n >endog</span><span class=o >=</span><span class=n >deltas</span><span class=p >[[</span><span class=s2 >"hrsemp"</span><span class=p >]])</span>
</pre></div> </div> </div> <div class="nboutput docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area stderr docutils container"> <div class=highlight ><pre>
/home/runner/work/linearmodels/linearmodels/linearmodels/iv/results.py:503: IndexWarning: The indices of exog and endog do not match.  Predictions created using the index of exog.
  pred = self.model.predict(self.params, exog=exog, endog=endog, data=data)
</pre></div></div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[38]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>predictions </table> </div></div> </div> </section> </section> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> <a href="../introduction.html" title=Introduction  class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev > <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis > <span class=md-footer-nav__direction > Previous </span> Introduction </span> </div> </a> <a href=advanced-examples.html  title="Further Examples" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next > <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class=md-flex__ellipsis > <span class=md-footer-nav__direction > Next </span> Further Examples </span> </div> <div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2017, Kevin Sheppard. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.2.3. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>