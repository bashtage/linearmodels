<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml"> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com" rel=preconnect  crossorigin=""> <link rel=stylesheet  href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono:400,500,700&display=fallback"> <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#2196f3"> <script src="../../_static/javascripts/modernizr.js"></script> <title>Further Examples &#8212; linearmodels 4.15.4+3.g8f4353e documentation</title> <link rel=apple-touch-icon  sizes=180x180  href="../../_static/icons/apple-touch-icon.png"> <link rel=icon  type="image/png" sizes=32x32  href="../../_static/icons/favicon-32x32.png"> <link rel=icon  type="image/png" sizes=16x16  href="../../_static/icons/favicon-16x16.png"> <link rel=manifest  href="../../_static/icons/site.webmanifest"> <link rel=mask-icon  href="../../_static/icons/safari-pinned-tab.svg" color="#2196f3"> <link rel="shortcut icon" href="../../_static/icons/favicon.ico"> <meta name=msapplication-TileColor  content="#f8f8f8"> <meta name=msapplication-config  content="../../_static/icons/browserconfig.xml"> <style> .highlight { background-color: hsla(0,0%,92.5%,.5) !important; } </style> <link rel=stylesheet  href="../../_static/material.css" type="text/css" /> <link rel=stylesheet  href="../../_static/pygments.css" type="text/css" /> <script type="text/javascript" id=documentation_options  data-url_root="../../" src="../../_static/documentation_options.js"></script> <script type="text/javascript" src="../../_static/jquery.js"></script> <script type="text/javascript" src="../../_static/underscore.js"></script> <script type="text/javascript" src="../../_static/doctools.js"></script> <script type="text/javascript" src="../../_static/language_data.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script async=async  type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script> <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script> <link rel="shortcut icon" href="../../_static/favicon.ico"/> <link rel=index  title=Index  href="../../genindex.html" /> <link rel=search  title=Search  href="../../search.html" /> <link rel=next  title="Using formulas to specify models" href=using-formulas.html  /> <link rel=prev  title="Basic Examples" href=basic-examples.html  /> <script src="../../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../../"versions.json"", target_loc = "../../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> <body dir=ltr data-md-color-primary=blue data-md-color-accent=orange> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#iv/examples/advanced-examples" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../../index.html" title="linearmodels 4.15.4+3.g8f4353e documentation" class="md-header-nav__button md-logo"> <img src="../../_static/bw-logo.svg" height=26  alt="linearmodels 4.15.4+3.g8f4353e documentation logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >linearmodels 4.15.4 (+3)</span> <span class=md-header-nav__topic > Further Examples </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../../search.html" method=GET  name=search > <input type=text  class=md-search__input  name=q  placeholder=Search  autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source > <a href="https://github.com/bashtage/linearmodels/" title="Go to repository" class=md-source  data-md-source=github > <div class=md-source__icon > <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width=28  height=28 > <use xlink:href="#__github" width=24  height=24 ></use> </svg> </div> <div class=md-source__repository > linearmodels </div> </a> </div> </div> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >Instrumental Variable Estimation</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../../index.html" title="linearmodels 4.15.4+3.g8f4353e documentation" class="md-nav__button md-logo"> <img src="../../_static/bw-logo.svg" alt=" logo" width=48  height=48 > </a> <a href="../../index.html" title="linearmodels 4.15.4+3.g8f4353e documentation">linearmodels 4.15.4 (+3)</a> </label> <div class=md-nav__source > <a href="https://github.com/bashtage/linearmodels/" title="Go to repository" class=md-source  data-md-source=github > <div class=md-source__icon > <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width=28  height=28 > <use xlink:href="#__github" width=24  height=24 ></use> </svg> </div> <div class=md-source__repository > linearmodels </div> </a> </div> <ul class=md-nav__list > <li class=md-nav__item > <a href="../index.html" class=md-nav__link >Instrumental Variable Estimation</a> <ul class=md-nav__list > <li class=md-nav__item > <a href="../introduction.html" class=md-nav__link >Introduction</a> <li class=md-nav__item > <a href=basic-examples.html  class=md-nav__link >Basic Examples</a> <li class=md-nav__item > <input class="md-toggle md-nav__toggle" data-md-toggle=toc  type=checkbox  id=__toc > <label class="md-nav__link md-nav__link--active" for=__toc > Further Examples </label> <a href="#" class="md-nav__link md-nav__link--active">Further Examples</a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >Contents</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#iv-examples-advanced-examples--page-root" class=md-nav__link >Further Examples</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Linear-Instrumental-Variables-Regression" class=md-nav__link >Linear Instrumental-Variables Regression</a> <li class=md-nav__item ><a href="#Importing-data" class=md-nav__link >Importing data</a> <li class=md-nav__item ><a href="#2SLS-as-OLS" class=md-nav__link >2SLS as OLS</a> <li class=md-nav__item ><a href="#Just-identified-2SLS" class=md-nav__link >Just identified 2SLS</a> <li class=md-nav__item ><a href="#Multiple-Instruments" class=md-nav__link >Multiple Instruments</a> <li class=md-nav__item ><a href="#Alternative-covariance-estimators" class=md-nav__link >Alternative covariance estimators</a> <li class=md-nav__item ><a href="#GMM-Estimation" class=md-nav__link >GMM Estimation</a> <li class=md-nav__item ><a href="#Changing-the-weighting-matrix-structure-in-GMM-estimation" class=md-nav__link >Changing the weighting matrix structure in GMM estimation</a> <li class=md-nav__item ><a href="#Continuously-updating-GMM" class=md-nav__link >Continuously updating GMM</a> <li class=md-nav__item ><a href="#Comparing-results" class=md-nav__link >Comparing results</a> <li class=md-nav__item ><a href="#Testing-endogeneity" class=md-nav__link >Testing endogeneity</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exogeneity-Testing" class=md-nav__link >Exogeneity Testing</a> </ul> </nav> <li class=md-nav__item ><a href="#Single-Instrument-Regressions" class=md-nav__link >Single Instrument Regressions</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#First-Stage-Diagnostics" class=md-nav__link >First Stage Diagnostics</a> </ul> </nav> <li class=md-nav__item ><a href="#LIML" class=md-nav__link >LIML</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#IV2SLS-as-OLS" class=md-nav__link >IV2SLS as OLS</a> </ul> </nav> </ul> </nav> <li class=md-nav__item ><a class=md-nav__extra_link  href="../../_sources/iv/examples/advanced-examples.ipynb.txt">Show Source</a> </ul> </nav> <li class=md-nav__item > <a href=using-formulas.html  class=md-nav__link >Using formulas to specify models</a> <li class=md-nav__item > <a href=absorbing-regression.html  class=md-nav__link >Absorbing Regression</a> <li class=md-nav__item > <a href="../reference.html" class=md-nav__link >Module Reference</a> <li class=md-nav__item > <a href="../mathematical-formula.html" class=md-nav__link >Formulas and Mathematical Detail</a> </ul> <li class=md-nav__item > <a href="../../panel/index.html" class=md-nav__link >Panel Data Model Estimation</a> <li class=md-nav__item > <a href="../../asset-pricing/index.html" class=md-nav__link >Linear Factor Models for Asset Pricing</a> <li class=md-nav__item > <a href="../../system/index.html" class=md-nav__link >System Regression Models</a> <li class=md-nav__item > <a href="../../utility.html" class=md-nav__link >Utilities</a> <li class=md-nav__item > <a href="../../plan.html" class=md-nav__link >Module Plans</a> <li class=md-nav__item > <a href="../../contributing.html" class=md-nav__link >Contributing</a> <li class=md-nav__item > <a href="../../changes.html" class=md-nav__link >Change Log</a> <li class=md-nav__item > <a href="../../references.html" class=md-nav__link >References</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >Contents</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#iv-examples-advanced-examples--page-root" class=md-nav__link >Further Examples</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Linear-Instrumental-Variables-Regression" class=md-nav__link >Linear Instrumental-Variables Regression</a> <li class=md-nav__item ><a href="#Importing-data" class=md-nav__link >Importing data</a> <li class=md-nav__item ><a href="#2SLS-as-OLS" class=md-nav__link >2SLS as OLS</a> <li class=md-nav__item ><a href="#Just-identified-2SLS" class=md-nav__link >Just identified 2SLS</a> <li class=md-nav__item ><a href="#Multiple-Instruments" class=md-nav__link >Multiple Instruments</a> <li class=md-nav__item ><a href="#Alternative-covariance-estimators" class=md-nav__link >Alternative covariance estimators</a> <li class=md-nav__item ><a href="#GMM-Estimation" class=md-nav__link >GMM Estimation</a> <li class=md-nav__item ><a href="#Changing-the-weighting-matrix-structure-in-GMM-estimation" class=md-nav__link >Changing the weighting matrix structure in GMM estimation</a> <li class=md-nav__item ><a href="#Continuously-updating-GMM" class=md-nav__link >Continuously updating GMM</a> <li class=md-nav__item ><a href="#Comparing-results" class=md-nav__link >Comparing results</a> <li class=md-nav__item ><a href="#Testing-endogeneity" class=md-nav__link >Testing endogeneity</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#Exogeneity-Testing" class=md-nav__link >Exogeneity Testing</a> </ul> </nav> <li class=md-nav__item ><a href="#Single-Instrument-Regressions" class=md-nav__link >Single Instrument Regressions</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#First-Stage-Diagnostics" class=md-nav__link >First Stage Diagnostics</a> </ul> </nav> <li class=md-nav__item ><a href="#LIML" class=md-nav__link >LIML</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#IV2SLS-as-OLS" class=md-nav__link >IV2SLS as OLS</a> </ul> </nav> </ul> </nav> <li class=md-nav__item ><a class=md-nav__extra_link  href="../../_sources/iv/examples/advanced-examples.ipynb.txt">Show Source</a> <li id=searchbox  class=md-nav__item > </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <style> /* CSS for nbsphinx extension */ /* remove conflicting styling from Sphinx themes */ div.nbinput.container, div.nbinput.container div.prompt, div.nbinput.container div.input_area, div.nbinput.container div[class*=highlight], div.nbinput.container div[class*=highlight] pre, div.nboutput.container, div.nboutput.container div.prompt, div.nboutput.container div.output_area, div.nboutput.container div[class*=highlight], div.nboutput.container div[class*=highlight] pre { background: none; border: none; padding: 0 0; margin: 0; box-shadow: none; } /* avoid gaps between output lines */ div.nboutput.container div[class*=highlight] pre { line-height: normal; } /* input/output containers */ div.nbinput.container, div.nboutput.container { display: -webkit-flex; display: flex; align-items: flex-start; margin: 0; width: 100%; } @media (max-width: 540px) { div.nbinput.container, div.nboutput.container { flex-direction: column; } } /* input container */ div.nbinput.container { padding-top: 5px; } /* last container */ div.nblast.container { padding-bottom: 5px; } /* input prompt */ div.nbinput.container div.prompt pre { color: #307FC1; } /* output prompt */ div.nboutput.container div.prompt pre { color: #BF5B3D; } /* all prompts */ div.nbinput.container div.prompt, div.nboutput.container div.prompt { min-width: 7ex; padding-top: 0.4em; padding-right: 0.4em; text-align: right; flex: 0; } @media (max-width: 540px) { div.nbinput.container div.prompt, div.nboutput.container div.prompt { text-align: left; padding: 0.4em; } div.nboutput.container div.prompt.empty { padding: 0; } } /* disable scrollbars on prompts */ div.nbinput.container div.prompt pre, div.nboutput.container div.prompt pre { overflow: hidden; } /* input/output area */ div.nbinput.container div.input_area, div.nboutput.container div.output_area { padding: 0.4em; -webkit-flex: 1; flex: 1; overflow: auto; } @media (max-width: 540px) { div.nbinput.container div.input_area, div.nboutput.container div.output_area { width: 100%; } } /* input area */ div.nbinput.container div.input_area { border: 1px solid #e0e0e0; border-radius: 2px; background: #f5f5f5; } /* override MathJax center alignment in output cells */ div.nboutput.container div[class*=MathJax] { text-align: left !important; } /* override sphinx.ext.imgmath center alignment in output cells */ div.nboutput.container div.math p { text-align: left; } /* standard error */ div.nboutput.container div.output_area.stderr { background: #fdd; } /* ANSI colors */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-default-inverse-fg { color: #FFFFFF; } .ansi-default-inverse-bg { background-color: #000000; } .ansi-bold { font-weight: bold; } .ansi-underline { text-decoration: underline; } /* Some additional styling taken form the Jupyter notebook CSS */ div.rendered_html table { border: none; border-collapse: collapse; border-spacing: 0; color: black; font-size: 12px; table-layout: fixed; } div.rendered_html thead { border-bottom: 1px solid black; vertical-align: bottom; } div.rendered_html tr, div.rendered_html th, div.rendered_html td { text-align: right; vertical-align: middle; padding: 0.5em 0.5em; line-height: normal; white-space: normal; max-width: none; border: none; } div.rendered_html th { font-weight: bold; } div.rendered_html tbody tr:nth-child(odd) { background: #f5f5f5; } div.rendered_html tbody tr:hover { background: rgba(66, 165, 245, 0.2); } </style> <h1 id=iv-examples-advanced-examples--page-root >Further Examples<a class=headerlink  href="#iv-examples-advanced-examples--page-root" title="Permalink to this headline">¶</a></h1> <h2 id=Linear-Instrumental-Variables-Regression >Linear Instrumental-Variables Regression<a class=headerlink  href="#Linear-Instrumental-Variables-Regression" title="Permalink to this headline">¶</a></h2> <p>These examples follow those in <strong>Chapter 6</strong> of <em>Microeconometrics Using Stata</em> by Cameron &amp; Trivedi.</p> <p>The first step is to import the main estimator for linear IV models:</p> <ul class=simple > <li><p><code class="docutils literal notranslate"><span class=pre >IV2SLS</span></code> - standard two-stage least squares</p> <li><p><code class="docutils literal notranslate"><span class=pre >IVLIML</span></code> - Limited information maximum likelihood and k-class estimators</p> <li><p><code class="docutils literal notranslate"><span class=pre >IVGMM</span></code> - Generalized method of moment estimation</p> <li><p><code class="docutils literal notranslate"><span class=pre >IVGMMCUE</span></code> - Generalized method of moment estimation using continuously updating</p> </ul> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[1]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=kn >from</span> <span class=nn >linearmodels</span> <span class=kn >import</span> <span class=n >IV2SLS</span><span class=p >,</span> <span class=n >IVLIML</span><span class=p >,</span> <span class=n >IVGMM</span><span class=p >,</span> <span class=n >IVGMMCUE</span>
</pre></div> </div> </div> <h2 id=Importing-data >Importing data<a class=headerlink  href="#Importing-data" title="Permalink to this headline">¶</a></h2> <p>The data uses comes from the Medical Expenditure Panel Survey (MEPS) and includes data on out-of-pocket drug expenditure (in logs), individual characteristics, whether an individual was insured through an employer or union (a likely endogenous variable), and some candidate instruments including the percentage of income from Social Security Income, the size of the individual’s firm and whether the firm has multiple locations.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[2]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=kn >from</span> <span class=nn >linearmodels.datasets</span> <span class=kn >import</span> <span class=n >meps</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >meps</span><span class=o >.</span><span class=n >load</span><span class=p >()</span>
<span class=n >data</span> <span class=o >=</span> <span class=n >data</span><span class=o >.</span><span class=n >dropna</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >meps</span><span class=o >.</span><span class=n >DESCR</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>

age               Age
age2              Age-squared
black             Black
blhisp            Black or Hispanic
drugexp           Presc-drugs expense
educyr            Years of education
fair              Fair health
female            Female
firmsz            Firm size
fph               fair or poor health
good              Good health
hi_empunion       Insured thro emp/union
hisp              Hiapanic
income            Income
ldrugexp          log(drugexp)
linc              log(income)
lowincome         Low income
marry             Married
midincome         Middle income
msa               Metropolitan stat area
multlc            Multiple locations
poor              Poor health
poverty           Poor
priolist          Priority list cond
private           Private insurance
ssiratio          SSI/Income ratio
totchr            Total chronic cond
vegood            V-good health
vgh               vg or good health

</pre></div></div> </div> <p>Next the data – dependent, endogenous and controls – are summarized. The controls are grouped into a list to simplify model building.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[3]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >controls</span> <span class=o >=</span> <span class=p >[</span><span class=s1 >'totchr'</span><span class=p >,</span> <span class=s1 >'female'</span><span class=p >,</span> <span class=s1 >'age'</span><span class=p >,</span> <span class=s1 >'linc'</span><span class=p >,</span><span class=s1 >'blhisp'</span><span class=p >]</span>
<span class=nb >print</span><span class=p >(</span><span class=n >data</span><span class=p >[[</span><span class=s1 >'ldrugexp'</span><span class=p >,</span><span class=s1 >'hi_empunion'</span><span class=p >]</span> <span class=o >+</span> <span class=n >controls</span><span class=p >]</span><span class=o >.</span><span class=n >describe</span><span class=p >(</span><span class=n >percentiles</span><span class=o >=</span><span class=p >[]))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
           ldrugexp   hi_empunion        totchr        female           age  \
count  10089.000000  10089.000000  10089.000000  10089.000000  10089.000000
mean       6.481361      0.382198      1.860938      0.577064     75.051740
std        1.362052      0.485949      1.292858      0.494050      6.682109
min        0.000000      0.000000      0.000000      0.000000     65.000000
50%        6.678342      0.000000      2.000000      1.000000     74.000000
max       10.180172      1.000000      9.000000      1.000000     91.000000

               linc        blhisp
count  10089.000000  10089.000000
mean       2.743275      0.163544
std        0.913143      0.369880
min       -6.907755      0.000000
50%        2.743160      0.000000
max        5.744476      1.000000
</pre></div></div> </div> <p>It is also worth examining the instruments.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[4]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >instruments</span> <span class=o >=</span> <span class=p >[</span><span class=s1 >'ssiratio'</span><span class=p >,</span> <span class=s1 >'lowincome'</span><span class=p >,</span> <span class=s1 >'multlc'</span><span class=p >,</span> <span class=s1 >'firmsz'</span><span class=p >]</span>
<span class=nb >print</span><span class=p >(</span><span class=n >data</span><span class=p >[</span><span class=n >instruments</span><span class=p >]</span><span class=o >.</span><span class=n >describe</span><span class=p >(</span><span class=n >percentiles</span><span class=o >=</span><span class=p >[]))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
           ssiratio     lowincome        multlc        firmsz
count  10089.000000  10089.000000  10089.000000  10089.000000
mean       0.536544      0.187432      0.062048      0.140529
std        0.367818      0.390277      0.241254      2.170389
min        0.000000      0.000000      0.000000      0.000000
50%        0.504522      0.000000      0.000000      0.000000
max        9.250620      1.000000      1.000000     50.000000
</pre></div></div> </div> <p>And finally the simple correlation between the endogenous variable and the instruments. Instruments must be correlated to be relevant (but also must be exogenous, which can’t be examined using simple correlation). The correlation of <code class="docutils literal notranslate"><span class=pre >firmsz</span></code> is especially low, which might lead to the weak instruments problem if used exclusively.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >data</span><span class=p >[[</span><span class=s1 >'hi_empunion'</span><span class=p >]</span> <span class=o >+</span> <span class=n >instruments</span><span class=p >]</span><span class=o >.</span><span class=n >corr</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[5]:
</pre></div> </div> <div class="output_area rendered_html docutils container"> <div> <style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } </style> <table border=1  class=dataframe > <thead> <tr style="text-align: right;"> <th> <th>hi_empunion <th>ssiratio <th>lowincome <th>multlc <th>firmsz <tr> <th>hi_empunion <td>1.000000 <td>-0.212431 <td>-0.116419 <td>0.119849 <td>0.037352 <tr> <th>ssiratio <td>-0.212431 <td>1.000000 <td>0.253946 <td>-0.190433 <td>-0.044578 <tr> <th>lowincome <td>-0.116419 <td>0.253946 <td>1.000000 <td>-0.062465 <td>-0.008232 <tr> <th>multlc <td>0.119849 <td>-0.190433 <td>-0.062465 <td>1.000000 <td>0.187275 <tr> <th>firmsz <td>0.037352 <td>-0.044578 <td>-0.008232 <td>0.187275 <td>1.000000 </table> </div></div> </div> <p><code class="docutils literal notranslate"><span class=pre >add_constant</span></code> from <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> is used to simplify the process of adding a constant column to the data.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[6]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=kn >from</span> <span class=nn >statsmodels.api</span> <span class=kn >import</span> <span class=n >OLS</span><span class=p >,</span> <span class=n >add_constant</span>
<span class=n >data</span><span class=p >[</span><span class=s1 >'const'</span><span class=p >]</span> <span class=o >=</span> <span class=mi >1</span>
<span class=n >controls</span> <span class=o >=</span> <span class=p >[</span><span class=s1 >'const'</span><span class=p >]</span> <span class=o >+</span> <span class=n >controls</span>
</pre></div> </div> </div> <h2 id=2SLS-as-OLS >2SLS as OLS<a class=headerlink  href="#2SLS-as-OLS" title="Permalink to this headline">¶</a></h2> <p>Before examining the IV estimators, it is worth noting that 2SLS nests the OLS estimator, so that a call to <code class="docutils literal notranslate"><span class=pre >IV2SLS</span></code> using <code class="docutils literal notranslate"><span class=pre >None</span></code> for the endogenous and instruments will produce OLS estimates of parameters.</p> <p>The OLS estimates indicate that insurance through an employer or union leads to an <strong>increase</strong> in out-of-pocket drug expenditure.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[7]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivolsmod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s1 >'hi_empunion'</span><span class=p >]</span> <span class=o >+</span> <span class=n >controls</span><span class=p >],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span>
<span class=n >res_ols</span> <span class=o >=</span> <span class=n >ivolsmod</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_ols</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:               ldrugexp   R-squared:                      0.1770
Estimator:                        OLS   Adj. R-squared:                 0.1765
No. Observations:               10089   F-statistic:                    2262.6
Date:                Fri, Jan 17 2020   P-value (F-stat)                0.0000
Time:                        17:27:08   Distribution:                  chi2(6)
Cov. Estimator:                robust

                              Parameter Estimates
===============================================================================
             Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
-------------------------------------------------------------------------------
hi_empunion     0.0739     0.0260     2.8441     0.0045      0.0230      0.1248
const           5.8611     0.1570     37.320     0.0000      5.5533      6.1689
totchr          0.4404     0.0094     47.049     0.0000      0.4220      0.4587
female          0.0578     0.0254     2.2797     0.0226      0.0081      0.1075
age            -0.0035     0.0019    -1.8228     0.0683     -0.0073      0.0003
linc            0.0105     0.0137     0.7646     0.4445     -0.0164      0.0373
blhisp         -0.1513     0.0341    -4.4353     0.0000     -0.2182     -0.0844
===============================================================================
</pre></div></div> </div> <h2 id=Just-identified-2SLS >Just identified 2SLS<a class=headerlink  href="#Just-identified-2SLS" title="Permalink to this headline">¶</a></h2> <p>The just identified two-stage LS estimator uses as many instruments as endogenous variables. In this example there is one of each, using the SSI ratio as the instrument. The with the instrument, the effect of insurance through employer or union has a strong negative effect on drug expenditure.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[8]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivmod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=o >.</span><span class=n >ssiratio</span><span class=p >)</span>
<span class=n >res_2sls</span> <span class=o >=</span> <span class=n >ivmod</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_2sls</span><span class=o >.</span><span class=n >summary</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:               ldrugexp   R-squared:                      0.0640
Estimator:                    IV-2SLS   Adj. R-squared:                 0.0634
No. Observations:               10089   F-statistic:                    2000.9
Date:                Fri, Jan 17 2020   P-value (F-stat)                0.0000
Time:                        17:27:08   Distribution:                  chi2(6)
Cov. Estimator:                robust

                              Parameter Estimates
===============================================================================
             Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
-------------------------------------------------------------------------------
const           6.7872     0.2688     25.246     0.0000      6.2602      7.3141
totchr          0.4503     0.0102     44.157     0.0000      0.4303      0.4703
female         -0.0204     0.0326    -0.6257     0.5315     -0.0843      0.0435
age            -0.0132     0.0030    -4.4092     0.0000     -0.0191     -0.0073
linc            0.0870     0.0226     3.8436     0.0001      0.0426      0.1314
blhisp         -0.2174     0.0395    -5.5052     0.0000     -0.2948     -0.1400
hi_empunion    -0.8976     0.2211    -4.0592     0.0000     -1.3310     -0.4642
===============================================================================

Endogenous: hi_empunion
Instruments: ssiratio
Robust Covariance (Heteroskedastic)
Debiased: False
</pre></div></div> </div> <h2 id=Multiple-Instruments >Multiple Instruments<a class=headerlink  href="#Multiple-Instruments" title="Permalink to this headline">¶</a></h2> <p>Using multiple instruments only requires expanding the data array in the instruments input.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[9]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivmod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s1 >'ssiratio'</span><span class=p >,</span><span class=s1 >'multlc'</span><span class=p >]])</span>
<span class=n >res_2sls_robust</span> <span class=o >=</span> <span class=n >ivmod</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
</pre></div> </div> </div> <h2 id=Alternative-covariance-estimators >Alternative covariance estimators<a class=headerlink  href="#Alternative-covariance-estimators" title="Permalink to this headline">¶</a></h2> <p>All estimator allow for three types of parameter covariance estimator:</p> <ul class=simple > <li><p><code class="docutils literal notranslate"><span class=pre >'unadjusted'</span></code> is the classic homoskedastic estimator</p> <li><p><code class="docutils literal notranslate"><span class=pre >'robust'</span></code> is robust to heteroskedasticity</p> <li><p><code class="docutils literal notranslate"><span class=pre >'clustered'</span></code> allows one- or two-way clustering to account for additional sources of dependence between the model scores</p> <li><p><code class="docutils literal notranslate"><span class=pre >'kernel'</span></code> produces a heteroskedasticity-autocorrelation robust covariance estimator</p> </ul> <p>The default is <code class="docutils literal notranslate"><span class=pre >'robust'</span></code>.</p> <p>These are all passed using the keyword input <code class="docutils literal notranslate"><span class=pre >cov_type</span></code>. Using clustered requires also passing the clustering variable(s).</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[10]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivmod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s1 >'ssiratio'</span><span class=p >,</span><span class=s1 >'multlc'</span><span class=p >]])</span>
<span class=n >res_2sls_std</span> <span class=o >=</span> <span class=n >ivmod</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s1 >'unadjusted'</span><span class=p >)</span>
</pre></div> </div> </div> <h2 id=GMM-Estimation >GMM Estimation<a class=headerlink  href="#GMM-Estimation" title="Permalink to this headline">¶</a></h2> <p>GMM estimation can be more efficient than 2SLS when there are more than one instrument. By default, 2-step efficient GMM is used (assuming the weighting matrix is correctly specified). It is possible to iterate until convergence using the optional keyword input <code class="docutils literal notranslate"><span class=pre >iter_limit</span></code>, which is naturally 2 by default. Generally, GMM-CUE would be preferred to using multiple iterations of standard GMM.</p> <p>The default weighting matrix is robust to heteroskedasticity (but not clustering).</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[11]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivmod</span> <span class=o >=</span><span class=n >IVGMM</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s1 >'ssiratio'</span><span class=p >,</span><span class=s1 >'multlc'</span><span class=p >]])</span>
<span class=n >res_gmm</span> <span class=o >=</span> <span class=n >ivmod</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
</pre></div> </div> </div> <h2 id=Changing-the-weighting-matrix-structure-in-GMM-estimation >Changing the weighting matrix structure in GMM estimation<a class=headerlink  href="#Changing-the-weighting-matrix-structure-in-GMM-estimation" title="Permalink to this headline">¶</a></h2> <p>The weighting matrix in the GMM objective function can be altered when creating the model. This example uses clustered weight by age. The covariance estimator should usually match the weighting matrix, and so clustering is also used here.</p> <div class="nbinput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[12]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivmod</span> <span class=o >=</span> <span class=n >IVGMM</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s1 >'ssiratio'</span><span class=p >,</span><span class=s1 >'multlc'</span><span class=p >]],</span>
                <span class=n >weight_type</span><span class=o >=</span><span class=s1 >'clustered'</span><span class=p >,</span> <span class=n >clusters</span><span class=o >=</span><span class=n >data</span><span class=o >.</span><span class=n >age</span><span class=p >)</span>
<span class=n >res_gmm_clustered</span> <span class=o >=</span> <span class=n >ivmod</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s1 >'clustered'</span><span class=p >,</span> <span class=n >clusters</span><span class=o >=</span><span class=n >data</span><span class=o >.</span><span class=n >age</span><span class=p >)</span>
</pre></div> </div> </div> <h2 id=Continuously-updating-GMM >Continuously updating GMM<a class=headerlink  href="#Continuously-updating-GMM" title="Permalink to this headline">¶</a></h2> <p>The continuously updating GMM estimator simultaneously optimizes the moment conditions and the weighting matrix. It can be more efficient (in the second order sense) than standard 2-step GMM, although it can also be fragile. Here the optional input <code class="docutils literal notranslate"><span class=pre >display</span></code> is used to produce the output of the non-linear optimizer used to estimate the parameters.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[13]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivmod</span> <span class=o >=</span> <span class=n >IVGMMCUE</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s1 >'ssiratio'</span><span class=p >,</span><span class=s1 >'multlc'</span><span class=p >]])</span>
<span class=n >res_gmm_cue</span> <span class=o >=</span> <span class=n >ivmod</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s1 >'robust'</span><span class=p >,</span> <span class=n >display</span><span class=o >=</span><span class=kc >True</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Warning: Desired error not necessarily achieved due to precision loss.
         Current function value: 1.045365
         Iterations: 10
         Function evaluations: 840
         Gradient evaluations: 92
</pre></div></div> </div> <h2 id=Comparing-results >Comparing results<a class=headerlink  href="#Comparing-results" title="Permalink to this headline">¶</a></h2> <p>The function <code class="docutils literal notranslate"><span class=pre >compare</span></code> can be used to compare the results of multiple models, possibly with different variables, estimators and/or instruments. Usually a dictionary or <code class="docutils literal notranslate"><span class=pre >OrderedDict</span></code> is used to hold results since the keys are used as model names. The advantage of an <code class="docutils literal notranslate"><span class=pre >OrderedDict</span></code> is that it will preserve the order of the models in the presentation.</p> <p>With the expectation of the OLS estimate, the parameter estimates are fairly consistent. Standard errors vary slightly although the conclusions reached are not sensitive to the choice of covariance estimator either. T-stats are reported in parentheses.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[14]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=kn >from</span> <span class=nn >collections</span> <span class=kn >import</span> <span class=n >OrderedDict</span>
<span class=kn >from</span> <span class=nn >linearmodels.iv.results</span> <span class=kn >import</span> <span class=n >compare</span>
<span class=n >res</span> <span class=o >=</span> <span class=n >OrderedDict</span><span class=p >()</span>
<span class=n >res</span><span class=p >[</span><span class=s1 >'OLS'</span><span class=p >]</span> <span class=o >=</span> <span class=n >res_ols</span>
<span class=n >res</span><span class=p >[</span><span class=s1 >'2SLS'</span><span class=p >]</span> <span class=o >=</span> <span class=n >res_2sls</span>
<span class=n >res</span><span class=p >[</span><span class=s1 >'2SLS-Homo'</span><span class=p >]</span> <span class=o >=</span> <span class=n >res_2sls_std</span>
<span class=n >res</span><span class=p >[</span><span class=s1 >'2SLS-Hetero'</span><span class=p >]</span> <span class=o >=</span> <span class=n >res_2sls_robust</span>
<span class=n >res</span><span class=p >[</span><span class=s1 >'GMM'</span><span class=p >]</span> <span class=o >=</span> <span class=n >res_gmm</span>
<span class=n >res</span><span class=p >[</span><span class=s1 >'GMM Cluster(Age)'</span><span class=p >]</span> <span class=o >=</span> <span class=n >res_gmm_clustered</span>
<span class=n >res</span><span class=p >[</span><span class=s1 >'GMM-CUE'</span><span class=p >]</span> <span class=o >=</span> <span class=n >res_gmm_cue</span>
<span class=nb >print</span><span class=p >(</span><span class=n >compare</span><span class=p >(</span><span class=n >res</span><span class=p >))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                                                     Model Comparison
==========================================================================================================================
                               OLS          2SLS      2SLS-Homo   2SLS-Hetero           GMM GMM Cluster(Age)       GMM-CUE
--------------------------------------------------------------------------------------------------------------------------
Dep. Variable             ldrugexp      ldrugexp       ldrugexp      ldrugexp      ldrugexp         ldrugexp      ldrugexp
Estimator                      OLS       IV-2SLS        IV-2SLS       IV-2SLS        IV-GMM           IV-GMM        IV-GMM
No. Observations             10089         10089          10089         10089         10089            10089         10089
Cov. Est.                   robust        robust     unadjusted        robust        robust        clustered        robust
R-squared                   0.1770        0.0640         0.0414        0.0414        0.0406           0.0292        0.0388
Adj. R-squared              0.1765        0.0634         0.0409        0.0409        0.0400           0.0286        0.0382
F-statistic                 2262.6        2000.9         1882.3        1955.4        1952.6           1700.8        1949.2
P-value (F-stat)            0.0000        0.0000         0.0000        0.0000        0.0000           0.0000        0.0000
==================     ===========   ===========   ============   ===========   ===========      ===========   ===========
hi_empunion                 0.0739       -0.8976        -0.9899       -0.9899       -0.9933          -1.0359       -1.0002
                          (2.8441)     (-4.0592)      (-5.1501)     (-4.8386)     (-4.8530)        (-5.0683)     (-4.8810)
const                       5.8611        6.7872         6.8752        6.8752        6.8778           6.7277        6.8847
                          (37.320)      (25.246)       (28.030)      (26.660)      (26.658)         (13.299)      (26.657)
totchr                      0.4404        0.4503         0.4512        0.4512        0.4510           0.4482        0.4510
                          (47.049)      (44.157)       (42.942)      (43.769)      (43.738)         (33.833)      (43.701)
female                      0.0578       -0.0204        -0.0278       -0.0278       -0.0282          -0.0245       -0.0288
                          (2.2797)     (-0.6257)      (-0.8933)     (-0.8653)     (-0.8752)        (-0.8398)     (-0.8928)
age                        -0.0035       -0.0132        -0.0141       -0.0141       -0.0142          -0.0119       -0.0142
                         (-1.8228)     (-4.4092)      (-5.0834)     (-4.8753)     (-4.8773)        (-1.8928)     (-4.8969)
linc                        0.0105        0.0870         0.0943        0.0943        0.0945           0.0957        0.0950
                          (0.7646)      (3.8436)       (4.4400)      (4.3079)      (4.3142)         (6.4934)      (4.3333)
blhisp                     -0.1513       -0.2174        -0.2237       -0.2237       -0.2231          -0.2091       -0.2236
                         (-4.4353)     (-5.5052)      (-5.7805)     (-5.6514)     (-5.6344)        (-4.1662)     (-5.6421)
==================== ============= ============= ============== ============= =============    ============= =============
Instruments                             ssiratio       ssiratio      ssiratio      ssiratio         ssiratio      ssiratio
                                                         multlc        multlc        multlc           multlc        multlc
--------------------------------------------------------------------------------------------------------------------------

T-stats reported in parentheses
</pre></div></div> </div> <h2 id=Testing-endogeneity >Testing endogeneity<a class=headerlink  href="#Testing-endogeneity" title="Permalink to this headline">¶</a></h2> <p>The Durbin test is a classic of endogeneity which compares OLS estimates with 2SLS and exploits the fact that OLS estimates will be relatively efficient. Durbin’s test is not robust to heteroskedasticity.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[15]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >res_2sls</span><span class=o >.</span><span class=n >durbin</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[15]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Durbin test of exogeneity
H0: All endogenous variables are exogenous
Statistic: 25.2819
P-value: 0.0000
Distributed: chi2(1)
WaldTestStatistic, id: 0x7f682a865310
</pre></div></div> </div> <p>The Wu-Hausman test is a variant of the Durbin test that uses a slightly different form.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[16]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >res_2sls</span><span class=o >.</span><span class=n >wu_hausman</span><span class=p >()</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[16]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Wu-Hausman test of exogeneity
H0: All endogenous variables are exogenous
Statistic: 25.3253
P-value: 0.0000
Distributed: F(1,10081)
WaldTestStatistic, id: 0x7f682a713f10
</pre></div></div> </div> <p>The test statistic can be directly replicated using the squared t-stat in a 2-stage approach where the first stage regresses the endogenous variable on the controls and instrument and the second stage regresses the dependent variable on the controls, the endogenous regressor and the residuals. If the regressor was in fact exogenous, the residuals should not be correlated with the dependent variable.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[17]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=kn >import</span> <span class=nn >pandas</span> <span class=k >as</span> <span class=nn >pd</span>
<span class=n >step1</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s1 >'ssiratio'</span><span class=p >]</span> <span class=o >+</span> <span class=n >controls</span><span class=p >],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >resids</span> <span class=o >=</span> <span class=n >step1</span><span class=o >.</span><span class=n >resids</span>
<span class=n >exog</span> <span class=o >=</span> <span class=n >pd</span><span class=o >.</span><span class=n >concat</span><span class=p >([</span><span class=n >data</span><span class=p >[[</span><span class=s1 >'hi_empunion'</span><span class=p >]</span> <span class=o >+</span> <span class=n >controls</span><span class=p >],</span> <span class=n >resids</span><span class=p >],</span><span class=mi >1</span><span class=p >)</span>
<span class=n >step2</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >exog</span><span class=p >,</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s1 >'unadjusted'</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >step2</span><span class=o >.</span><span class=n >tstats</span><span class=o >.</span><span class=n >residual</span> <span class=o >**</span><span class=mi >2</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
25.34541049974397
</pre></div></div> </div> <p>Wooldridge’s regression-based test of exogeneity is robust to heteroskedasticity since it inherits the covariance estimator from the model. Here there is little difference.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[18]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >res_2sls</span><span class=o >.</span><span class=n >wooldridge_regression</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[18]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Wooldridge's regression test of exogeneity
H0: Endogenous variables are exogenous
Statistic: 26.4542
P-value: 0.0000
Distributed: chi2(1)
WaldTestStatistic, id: 0x7f6829aa0450
</pre></div></div> </div> <p>Wooldridge’s score test is an alternative to the regression test, although it usually has slightly less power since it is an LM rather than a Wald type test.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[19]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >res_2sls</span><span class=o >.</span><span class=n >wooldridge_score</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[19]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
Wooldridge's score test of exogeneity
H0: Endogenous variables are exogenous
Statistic: 24.9350
P-value: 0.0000
Distributed: chi2(1)
WaldTestStatistic, id: 0x7f6829aa0b10
</pre></div></div> </div> <h3 id=Exogeneity-Testing >Exogeneity Testing<a class=headerlink  href="#Exogeneity-Testing" title="Permalink to this headline">¶</a></h3> <p>When there is more than one instrument (the model is overidentified), the J test can be used in GMM models to test whether the model is overidentified – in other words, whether the instruments are actually exogenous (assuming they are relevant). In the case with 2 instruments there is no evidence that against the null.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[20]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >res_gmm</span><span class=o >.</span><span class=n >j_stat</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[20]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
H0: Expected moment conditions are equal to 0
Statistic: 1.0475
P-value: 0.3061
Distributed: chi2(1)
WaldTestStatistic, id: 0x7f682a575d50
</pre></div></div> </div> <p>When all instruments are included the story changes, and some of the additional instrument (<code class="docutils literal notranslate"><span class=pre >lowincome</span></code> or <code class="docutils literal notranslate"><span class=pre >firmsz</span></code>) appear to be endogenous.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[21]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivmod</span> <span class=o >=</span> <span class=n >IVGMM</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >instruments</span><span class=p >])</span>
<span class=n >res_gmm_all</span> <span class=o >=</span> <span class=n >ivmod</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >res_gmm_all</span><span class=o >.</span><span class=n >j_stat</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[21]:
</pre></div> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
H0: Expected moment conditions are equal to 0
Statistic: 11.5903
P-value: 0.0089
Distributed: chi2(3)
WaldTestStatistic, id: 0x7f6829a9d850
</pre></div></div> </div> <h2 id=Single-Instrument-Regressions >Single Instrument Regressions<a class=headerlink  href="#Single-Instrument-Regressions" title="Permalink to this headline">¶</a></h2> <p>It can be useful to run the just identified regressions to see how the IV estimate varies by instrument. The OLS model is included for comparison. The coefficient when using <code class="docutils literal notranslate"><span class=pre >lowincome</span></code> is very similar to the OLS as is the <span class="math notranslate nohighlight">\(R^2\)</span> which indicates this variable may be endogenous. The coefficient using <code class="docutils literal notranslate"><span class=pre >firmsz</span></code> is also very different, but this is probably due to the low correlation between <code class="docutils literal notranslate"><span class=pre >firmsz</span></code> and the endogenous regressor so that this is a weak instrument.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[22]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >od</span> <span class=o >=</span> <span class=n >OrderedDict</span><span class=p >()</span>
<span class=k >for</span> <span class=n >col</span> <span class=ow >in</span> <span class=n >instruments</span><span class=p >:</span>
    <span class=n >od</span><span class=p >[</span><span class=n >col</span><span class=p >]</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >col</span><span class=p >])</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s1 >'robust'</span><span class=p >)</span>
<span class=n >od</span><span class=p >[</span><span class=s1 >'OLS'</span><span class=p >]</span> <span class=o >=</span> <span class=n >res_ols</span>
<span class=nb >print</span><span class=p >(</span><span class=n >compare</span><span class=p >(</span><span class=n >od</span><span class=p >))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                                     Model Comparison
==========================================================================================
                          ssiratio     lowincome        multlc        firmsz           OLS
------------------------------------------------------------------------------------------
Dep. Variable             ldrugexp      ldrugexp      ldrugexp      ldrugexp      ldrugexp
Estimator                  IV-2SLS       IV-2SLS       IV-2SLS       IV-2SLS           OLS
No. Observations             10089         10089         10089         10089         10089
Cov. Est.                   robust        robust        robust        robust        robust
R-squared                   0.0640        0.1768       -0.0644       -0.9053        0.1770
Adj. R-squared              0.0634        0.1763       -0.0651       -0.9064        0.1765
F-statistic                 2000.9        2250.6        1734.1        950.64        2262.6
P-value (F-stat)            0.0000        0.0000        0.0000        0.0000        0.0000
==================     ===========   ===========   ===========   ===========   ===========
const                       6.7872        5.8201        7.2145        8.7267        5.8611
                          (25.246)      (15.267)      (16.326)      (6.4196)      (37.320)
totchr                      0.4503        0.4399        0.4548        0.4710        0.4404
                          (44.157)      (43.834)      (39.193)      (23.163)      (47.049)
female                     -0.0204        0.0613       -0.0565       -0.1842        0.0578
                         (-0.6257)      (1.6066)     (-1.2596)     (-1.5312)      (2.2797)
age                        -0.0132       -0.0031       -0.0177       -0.0335       -0.0035
                         (-4.4092)     (-0.7521)     (-3.7086)     (-2.3433)     (-1.8228)
linc                        0.0870        0.0071        0.1223        0.2473        0.0105
                          (3.8436)      (0.2280)      (3.2965)      (2.1876)      (0.7646)
blhisp                     -0.2174       -0.1484       -0.2479       -0.3559       -0.1513
                         (-5.5052)     (-3.5639)     (-5.0727)     (-3.2425)     (-4.4353)
hi_empunion                -0.8976        0.1170       -1.3459       -2.9323        0.0739
                         (-4.0592)      (0.3254)     (-3.1760)     (-2.0908)      (2.8441)
==================== ============= ============= ============= ============= =============
Instruments               ssiratio     lowincome        multlc        firmsz
------------------------------------------------------------------------------------------

T-stats reported in parentheses
</pre></div></div> </div> <h3 id=First-Stage-Diagnostics >First Stage Diagnostics<a class=headerlink  href="#First-Stage-Diagnostics" title="Permalink to this headline">¶</a></h3> <p>First stage diagnostics are available to assess whether the instruments appear to be credible for the endogenous regressor. The Partial F-statistic is the F-statistic for all instruments once controls have been partialed out. In the case of a single instrument, it is just the squared t-stat.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[23]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=nb >print</span><span class=p >(</span><span class=n >res_2sls</span><span class=o >.</span><span class=n >first_stage</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
    First Stage Estimation Results
======================================
                           hi_empunion
--------------------------------------
R-squared                       0.0761
Partial R-squared               0.0179
Shea's R-squared                0.0179
Partial F-statistic             65.806
P-value (Partial F-stat)     4.441e-16
Partial F-stat Distn           chi2(1)
========================== ===========
const                           1.0290
                              (17.705)
totchr                          0.0128
                              (3.4896)
female                         -0.0734
                             (-7.6226)
age                            -0.0086
                             (-12.184)
linc                            0.0484
                              (7.3266)
blhisp                         -0.0627
                             (-5.1084)
ssiratio                       -0.1916
                             (-8.1121)
--------------------------------------

T-stats reported in parentheses
T-stats use same covariance type as original model
</pre></div></div> </div> <p>The F-statistic actually has a <span class="math notranslate nohighlight">\(chi^2\)</span> distribution since it is just a Wald test that all of the coefficients are 0. This breaks the “rule-of-thumb” but it can be applied by dividing the F-stat by the number of instruments.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[24]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivmod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >instruments</span><span class=p >])</span>
<span class=n >res_2sls_all</span> <span class=o >=</span> <span class=n >ivmod</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=nb >print</span><span class=p >(</span><span class=n >res_2sls_all</span><span class=o >.</span><span class=n >first_stage</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
    First Stage Estimation Results
======================================
                           hi_empunion
--------------------------------------
R-squared                       0.0821
Partial R-squared               0.0243
Shea's R-squared                0.0243
Partial F-statistic             179.47
P-value (Partial F-stat)        0.0000
Partial F-stat Distn           chi2(4)
========================== ===========
const                           0.9899
                              (16.959)
totchr                          0.0133
                              (3.6494)
female                         -0.0724
                             (-7.5497)
age                            -0.0080
                             (-11.206)
linc                            0.0410
                              (6.3552)
blhisp                         -0.0676
                             (-5.5369)
ssiratio                       -0.1690
                             (-7.3289)
lowincome                      -0.0637
                             (-5.1947)
multlc                          0.1151
                              (5.4799)
firmsz                          0.0037
                              (1.9286)
--------------------------------------

T-stats reported in parentheses
T-stats use same covariance type as original model
</pre></div></div> </div> <h2 id=LIML >LIML<a class=headerlink  href="#LIML" title="Permalink to this headline">¶</a></h2> <p>The LIML estimator and related k-class estimators can be used through <code class="docutils literal notranslate"><span class=pre >IVLIML</span></code>. LIML can have better finite sample properties if the model is not strongly identified. By default the <span class="math notranslate nohighlight">\(\kappa\)</span> parameter is estimated. In this dataset it is very close to 1 and to the results for LIML are similar to 2SLS (they would be exact if <span class="math notranslate nohighlight">\(\kappa=1\)</span>).</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[25]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=n >ivmod</span> <span class=o >=</span> <span class=n >IVLIML</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[</span><span class=n >controls</span><span class=p >],</span> <span class=n >data</span><span class=o >.</span><span class=n >hi_empunion</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s1 >'ssiratio'</span><span class=p >,</span><span class=s1 >'multlc'</span><span class=p >]])</span>
<span class=n >res_liml</span> <span class=o >=</span> <span class=n >ivmod</span><span class=o >.</span><span class=n >fit</span><span class=p >(</span><span class=n >cov_type</span><span class=o >=</span><span class=s1 >'robust'</span><span class=p >)</span>
<span class=nb >print</span><span class=p >(</span><span class=n >compare</span><span class=p >({</span><span class=s1 >'2SLS'</span><span class=p >:</span><span class=n >res_2sls_robust</span><span class=p >,</span><span class=s1 >'LIML'</span><span class=p >:</span> <span class=n >res_liml</span><span class=p >,</span> <span class=s1 >'GMM'</span><span class=p >:</span> <span class=n >res_gmm</span><span class=p >}))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
                       Model Comparison
==============================================================
                              2SLS          LIML           GMM
--------------------------------------------------------------
Dep. Variable             ldrugexp      ldrugexp      ldrugexp
Estimator                  IV-2SLS       IV-LIML        IV-GMM
No. Observations             10089         10089         10089
Cov. Est.                   robust        robust        robust
R-squared                   0.0414        0.0400        0.0406
Adj. R-squared              0.0409        0.0394        0.0400
F-statistic                 1955.4        1952.3        1952.6
P-value (F-stat)            0.0000        0.0000        0.0000
==================     ===========   ===========   ===========
const                       6.8752        6.8807        6.8778
                          (26.660)      (26.577)      (26.658)
totchr                      0.4512        0.4513        0.4510
                          (43.769)      (43.730)      (43.738)
female                     -0.0278       -0.0283       -0.0282
                         (-0.8653)     (-0.8776)     (-0.8752)
age                        -0.0141       -0.0142       -0.0142
                         (-4.8753)     (-4.8781)     (-4.8773)
linc                        0.0943        0.0947        0.0945
                          (4.3079)      (4.3114)      (4.3142)
blhisp                     -0.2237       -0.2241       -0.2231
                         (-5.6514)     (-5.6531)     (-5.6344)
hi_empunion                -0.9899       -0.9957       -0.9933
                         (-4.8386)     (-4.8361)     (-4.8530)
==================== ============= ============= =============
Instruments               ssiratio      ssiratio      ssiratio
                            multlc        multlc        multlc
--------------------------------------------------------------

T-stats reported in parentheses
</pre></div></div> </div> <p>The estimated value of <span class="math notranslate nohighlight">\(\kappa\)</span>.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[26]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=nb >print</span><span class=p >(</span><span class=n >res_liml</span><span class=o >.</span><span class=n >kappa</span><span class=p >)</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
1.0001153166806431
</pre></div></div> </div> <h3 id=IV2SLS-as-OLS >IV2SLS as OLS<a class=headerlink  href="#IV2SLS-as-OLS" title="Permalink to this headline">¶</a></h3> <p>As one final check, the “OLS” version of <code class="docutils literal notranslate"><span class=pre >IV2SLS</span></code> is compared to <code class="docutils literal notranslate"><span class=pre >statsmodels</span></code> <code class="docutils literal notranslate"><span class=pre >OLS</span></code> command. The parameters are identical.</p> <div class="nbinput docutils container"> <div class="prompt highlight-none notranslate"><div class=highlight ><pre><span></span>[27]:
</pre></div> </div> <div class="input_area highlight-ipython3 notranslate"><div class=highlight ><pre>
<span></span><span class=kn >import</span> <span class=nn >pandas</span> <span class=k >as</span> <span class=nn >pd</span>
<span class=n >ivolsmod</span> <span class=o >=</span> <span class=n >IV2SLS</span><span class=p >(</span><span class=n >data</span><span class=o >.</span><span class=n >ldrugexp</span><span class=p >,</span> <span class=n >data</span><span class=p >[[</span><span class=s1 >'hi_empunion'</span><span class=p >]</span> <span class=o >+</span> <span class=n >controls</span><span class=p >],</span> <span class=kc >None</span><span class=p >,</span> <span class=kc >None</span><span class=p >)</span>
<span class=n >res_ivols</span> <span class=o >=</span> <span class=n >ivolsmod</span><span class=o >.</span><span class=n >fit</span><span class=p >()</span>
<span class=n >sm_ols</span> <span class=o >=</span> <span class=n >res_ols</span><span class=o >.</span><span class=n >params</span>
<span class=n >sm_ols</span><span class=o >.</span><span class=n >name</span> <span class=o >=</span> <span class=s1 >'sm'</span>
<span class=nb >print</span><span class=p >(</span><span class=n >pd</span><span class=o >.</span><span class=n >concat</span><span class=p >([</span><span class=n >res_ivols</span><span class=o >.</span><span class=n >params</span><span class=p >,</span> <span class=n >sm_ols</span><span class=p >],</span> <span class=mi >1</span><span class=p >))</span>
</pre></div> </div> </div> <div class="nboutput nblast docutils container"> <div class="prompt empty docutils container"> </div> <div class="output_area docutils container"> <div class=highlight ><pre>
             parameter        sm
hi_empunion   0.073879  0.073879
const         5.861131  5.861131
totchr        0.440381  0.440381
female        0.057806  0.057806
age          -0.003529 -0.003529
linc          0.010482  0.010482
blhisp       -0.151307 -0.151307
</pre></div></div> </div> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> <a href=basic-examples.html  title=Material  class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev > <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis > <span class=md-footer-nav__direction > Previous </span> Basic Examples </span> </div> </a> <a href=using-formulas.html  title=Admonition  class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next > <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class=md-flex__ellipsis > <span class=md-footer-nav__direction > Next </span> Using formulas to specify models </span> </div> <div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2017, Kevin Sheppard. </div> Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>