

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Formulas and Mathematical Detail &#8212; linearmodels 4.1 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="System Regression Models" href="../system/index.html" />
    <link rel="prev" title="Linear Asset Pricing Model Covariance Estimators" href="covariance.html" />
  
  
   

  <link rel="stylesheet" href="../_static/css/overrides.css" type="text/css" />

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../system/index.html" title="System Regression Models"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="covariance.html" title="Linear Asset Pricing Model Covariance Estimators"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">linearmodels 4.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Linear Factor Models for Asset Pricing</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
        <a href="
    ../index.html" class="text-logo">linearmodels 4.1</a>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../iv/index.html">Instrumental Variable Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../panel/index.html">Panel Data Model Estimation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linear Factor Models for Asset Pricing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/formulas.html">Using Formulas</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Module Reference</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Formulas and Mathematical Detail</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../system/index.html">System Regression Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utility.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plan.html">Module Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

    
  </div>
</div>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
                <li><a href="index.html">Linear Factor Models for Asset Pricing</a></li>
              
              <li>Formulas and Mathematical Detail</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="formulas-and-mathematical-detail">
<span id="asset-pricing-mathematical-notation"></span><h1>Formulas and Mathematical Detail<a class="headerlink" href="#formulas-and-mathematical-detail" title="Permalink to this headline">¶</a></h1>
<p>There are <span class="math">\(N\)</span> test portfolios, <span class="math">\(r_{t}\)</span> (<span class="math">\(p\)</span> by 1)
which are usually assumed to be excess returns (zero-investment
portfolios) and <span class="math">\(K\)</span> factors, <span class="math">\(f_{t}\)</span> (<span class="math">\(k\)</span> by 1). For
return series there are <span class="math">\(T\)</span> observations.</p>
<div class="section" id="linear-factor-model-for-traded-factors">
<h2>Linear Factor Model for Traded Factors<a class="headerlink" href="#linear-factor-model-for-traded-factors" title="Permalink to this headline">¶</a></h2>
<p>This model is a Seemingly Unrelated Regression (SUR). All models share
the same regressors so that the model for test portfolio <span class="math">\(i\)</span> is</p>
<div class="math">
\[r_{it}=\alpha_{i}+\beta_{i}f_{t}+\epsilon_{it}.\]</div>
<p>Inference is based on the sandwich covariance estimator</p>
<div class="math">
\[\hat{\Sigma}=\left(T-df\right)^{-1}G^{-1}SG^{-1}.\]</div>
<p>Define <span class="math">\(f_{c,t}=\left[1\:f_{t}^{\prime}\right]^{\prime}\)</span>, then</p>
<div class="math">
\[\hat{G}=I_{N}\otimes\Sigma_{f_{c}}\]</div>
<p>and</p>
<div class="math">
\[\Sigma_{f_{c}}=T^{-1}\sum_{t=1}^{T}f_{c,t}f_{c,t}^{\prime}\]</div>
<p>Define the stacked vector of scores (or moment conditions)</p>
<div class="math">
\[g_{t}=\left[f_{c}\otimes\hat{\epsilon}_{t}\right].\]</div>
<p>If the heteroskedasticity robust estimator is used,</p>
<div class="math">
\[\hat{S}=T^{-1}\sum_{t=1}^{T}g_{t}g_{t}^{\prime}.\]</div>
<p>If the HAC estimator is used,</p>
<div class="math">
\[\begin{split}\begin{aligned}
\hat{S} &amp; =T^{-1}\left\{ \hat{\Gamma}_{0}+\sum_{i=1}^{bw}K\left(\frac{i}{bw}\right)\left(\hat{\Gamma}_{i}+\hat{\Gamma}_{i}^{\prime}\right)\right\} \\
\hat{\Gamma}_{j} &amp; =\sum_{t=j+1}^{T}g_{t}g_{t-j}^{\prime}\end{aligned}\end{split}\]</div>
<p>where <span class="math">\(K\left(\frac{i}{bw}\right)\)</span> is a kernel weighting function
and <span class="math">\(bw\)</span> is the bandwidth. The reported risk premia are just the
average returns on the factors, and the covariance of the risk premia
estimates is based on the factor residuals after demeaning using either
the simple estimator or the kernel estimator.</p>
<div class="section" id="the-j-statistic">
<h3>The J statistic<a class="headerlink" href="#the-j-statistic" title="Permalink to this headline">¶</a></h3>
<p>The J statistic is implemented as</p>
<div class="math">
\[J=\hat{\alpha}^{\prime}\hat{\Sigma}_{\alpha}^{-1}\hat{\alpha}^{\prime}\sim\chi_{N}^{2}\]</div>
<p>where <span class="math">\(\hat{\Sigma}_{\alpha}\)</span> consists of rows and
columns<span class="math">\(1,(k+1)+1,2(k+1)+1,\ldots\)</span> of <span class="math">\(\hat{\Sigma}\)</span>.</p>
</div>
</div>
<div class="section" id="linear-factor-model-for-non-traded-factors">
<h2>Linear Factor Model for Non-traded Factors<a class="headerlink" href="#linear-factor-model-for-non-traded-factors" title="Permalink to this headline">¶</a></h2>
<p>When factors are not traded, the SUR approach cannot be used since the
expected value of the factor is not equal to its risk premium. One
solution is to use a multi-step estimator. The first step regresses the
test portfolio returns on the factors and a (throw-away) constant. This
constant is included only to demean the factors to compute the correct
factor loadings. The second stage then uses the estimated factor
loadings and the average portfolio returns to estimate the risk premia.
This second stage can be (optionally) improved by removing the effects
of the demeaned factors from returns when computing risk premia.</p>
<p>The first stage regressions are virtually identical to the SUR
regressions except the constant is no longer <span class="math">\(\alpha_{i}\)</span>,</p>
<div class="math">
\[r_{it}^{e}=c_{i}+\beta_{i}f_{t}+\epsilon_{it}.\]</div>
<p>The second stage regression then uses the estimated coefficients as
regressors to estimate the risk premia,</p>
<div class="math">
\[\bar{r}_{i}^{e}=\left[1_{N}\,\hat{\beta}\right]\lambda+\eta_{i}.\]</div>
<p>Note that the residual from this
regression<span class="math">\(\hat{\eta}_{i}=\hat{\alpha}_{i}\)</span>, the excess
compensation test portfolio <span class="math">\(i\)</span> is generating. If the risk free
rate is assumed to be 0, then the column of 1s is not included and
<span class="math">\(\lambda\)</span> is <span class="math">\(K\)</span> by 1.</p>
<p>Inference is conducted by treating this as a 3-step GMM problem where
the first two steps were just described and the third estimated the
model <span class="math">\(\hat{\alpha}\)</span>. The moment conditions corresponding to the
FOC of these three steps are</p>
<div class="math">
\[\begin{split}g_{t}=\left[\begin{array}{c}
f_{c,t}\otimes\epsilon_{t}\\
\left[1_{N}\,\beta\right]^{\prime}\left(r_{t}-\left[1_{N}\,\beta\right]\lambda\right)\\
r_{t}-\left[1_{N}\,\beta\right]\lambda-\alpha
\end{array}\right]\end{split}\]</div>
<p>where <span class="math">\(\epsilon_{it}=r_{it}^{e}-c_{i}-\beta_{i}f_{t}\)</span> is <span class="math">\(N\)</span>
by 1 , <span class="math">\(\beta\)</span> is <span class="math">\(N\)</span> by <span class="math">\(K\)</span>, <span class="math">\(\lambda\)</span> is
<span class="math">\(K+1\)</span> by 1 and<span class="math">\(\alpha\)</span> is <span class="math">\(N\)</span> by 1. Inference is
based on</p>
<div class="math">
\[\hat{\Sigma}=\left(T-df\right)^{-1}G^{-1}S\left(G^{-1}\right)^{\prime}\]</div>
<p>where the Jacobian <span class="math">\(G\)</span> is estimated by</p>
<div class="math">
\[\begin{split}\hat{G}=-\left[\begin{array}{ccc}
I_{N}\otimes\Sigma_{f_{c}} &amp; 0 &amp; 0\\
G_{21} &amp; \left[1_{N}\,\hat{\beta}\right]^{\prime}\left[1_{N}\,\hat{\beta}\right] &amp; 0\\
I_{N}\otimes\left[0\ \hat{\lambda}\right] &amp; \left[1_{N}\,\hat{\beta}\right] &amp; I_{N}
\end{array}\right]\end{split}\]</div>
<p>The block <span class="math">\(G_{21}\)</span>is</p>
<div class="math">
\[G_{21}=\left[G_{21,1}\ G_{21,2}\:\ldots\ G_{21,N}\right]\]</div>
<div class="math">
\[G_{21,i}=\left[0_{\left(K+1\right)\times1}\;\left(\left[1\;\hat{\beta}_{i}\right]^{\prime}\lambda^{\prime}-\left[0_{K}\;\bar{u}_{i}I_{K}\right]^{\prime}\right)\right]\]</div>
<p>When the risk free rate is 0, all terms of the form
<span class="math">\([1_{N}\;\beta]\)</span> become <span class="math">\(\beta\)</span> and</p>
<div class="math">
\[G_{21,i}=\left[0_{K\times1}\;\left(\hat{\beta}_{i}^{\prime}\lambda^{\prime}-\;\bar{u}_{i}I_{K}\right)\right]\]</div>
<p><span class="math">\(S\)</span> is an estimator of the covariance of the moment conditions,
<span class="math">\(g_{t}\)</span>, and its form is identical to either the
heteroskedasticity consistent estimator or the HAC estimator in the
previous section.</p>
<div class="section" id="improved-specification-using-gls">
<h3>Improved Specification using GLS<a class="headerlink" href="#improved-specification-using-gls" title="Permalink to this headline">¶</a></h3>
<div class="math">
\[\begin{split}\left[\begin{array}{c}
f_{c,t}\otimes\epsilon_{t}\\
\beta_{c}^{\prime}\Sigma^{-1}\left(r_{t}-\beta_{c}\lambda\right)\\
r_{t}-\beta_{c}\lambda-\alpha
\end{array}\right]\end{split}\]</div>
<p>The Jacobian is than</p>
<div class="math">
\[\begin{split}\hat{G}=-\left[\begin{array}{ccc}
I_{N}\otimes\Sigma_{f_{c}} &amp; 0 &amp; 0\\
G_{12} &amp; \hat{\beta}_{c}^{\prime}\Sigma^{-1}\hat{\beta}_{c} &amp; 0\\
I_{N}\otimes\left[0\ \tilde{\lambda}\right] &amp; \hat{\beta}_{c} &amp; I_{N}
\end{array}\right]\end{split}\]</div>
<p><span class="math">\(\beta_{c}=\left[1_{N}\,\beta\right]\)</span>.
<span class="math">\(\tilde{\lambda}=\left[\lambda_{1},\ldots,\lambda_{K}\right]\)</span> and
so does not include the risk-free rate <span class="math">\(\lambda_{0}\)</span> when included
in the model. The final piece has the structure</p>
<div class="math">
\[G_{21}=\left[G_{21,1}\ G_{21,2}\:\ldots\ G_{21,N}\right]\]</div>
<div class="math">
\[G_{21,i}=\left[0_{\left(K+1\right)}\;\tilde{\beta}_{c,i}^{\prime}\tilde{\lambda}^{\prime}-\left[0_{K}\;\bar{u}_{i}I_{K}\right]^{\prime}\right]\]</div>
<p>where <span class="math">\(\tilde{\beta}_{c,i}\)</span> is row <span class="math">\(i\)</span> of
<span class="math">\(\Sigma^{-1}\beta_{c}\)</span>,
<span class="math">\(\bar{u}_{i}=T^{-1}\sum_{t=1}^{T}\tilde{u}_{it}\)</span> and
<span class="math">\(\tilde{u}_{it}\)</span> is the element in position <span class="math">\(i\)</span> of
<span class="math">\(\tilde{u}_{t}=\Sigma^{-1}\left(r_{t}-\lambda_{0}-\beta\tilde{\lambda}\right)\)</span>.
Each block has a 0 columns corresponding to <span class="math">\(c_{i}\)</span>.</p>
<p><span class="math">\(S\)</span> is an estimator of the covariance of the moment conditions,
<span class="math">\(g_{t}\)</span>, and its form is identical to either the
heteroskedasticity consistent estimator or the HAC estimator in the
previous section.</p>
</div>
<div class="section" id="id1">
<h3>The J statistic<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The J statistic is virtually identical to the <span class="math">\(J\)</span> statistic from
traded factor model except that it has a difference distribution.</p>
<div class="math">
\[J=\hat{\alpha}^{\prime}\hat{\Sigma}_{\alpha}^{-1}\hat{\alpha}^{\prime}\sim\chi_{N-K}^{2}\]</div>
<p>The loss of degrees of freedom occurs since
<span class="math">\(\hat{\alpha}=\hat{\eta}\)</span> which are regression residuals from a
regression of <span class="math">\(N\)</span> average returns on <span class="math">\(K\)</span> factor loadings.
<span class="math">\(\hat{\Sigma}_{\alpha}\)</span> is the bottom right <span class="math">\(K\times K\)</span>
block of <span class="math">\(\hat{\Sigma}\)</span>.</p>
</div>
</div>
<div class="section" id="gmm-estimation-of-linear-factor-models">
<h2>GMM Estimation of Linear Factor Models<a class="headerlink" href="#gmm-estimation-of-linear-factor-models" title="Permalink to this headline">¶</a></h2>
<p>The GMM estimator solves a set of non-linear moment conditions of the
form</p>
<div class="math">
\[\begin{split}\left[\begin{array}{c}
\epsilon_{t}\otimes f_{c,t}\\
f_{t}-\mu
\end{array}\right]\end{split}\]</div>
<p>where</p>
<div class="math">
\[\epsilon_{t}=r_{t}-\left[1_{N}\;\beta\right]\lambda-\beta\left(f_{t}-\mu\right)\]</div>
<p>is the vector of pricing errors. The factors can be traded or
non-traded. This assumes that the model for expected returns is</p>
<div class="math">
\[E\left[r_{it}\right]=\lambda_{0}+\sum_{i=1}^{k}\beta_{i}\lambda_{i}\]</div>
<p>so that the risk-free rate might not be zero. This form is sometimes
used with excess returns if there is doubt about the risk-free rate
used. The Jacobian is then</p>
<div class="math">
\[\begin{split}\hat{G}=T^{-1}\sum_{t=1}^{T}-\left[\begin{array}{ccc}
I_{N}\otimes\left(f_{t}-\mu+\tilde{\lambda}\right)f_{c,t} &amp; \left[\begin{array}{c}
f_{c,t}\left[1\!\hat{\beta}_{1}\right]\\
\vdots\\
f_{c,t}\left[1\!\hat{\beta}_{N}\right]
\end{array}\right] &amp; \left[\begin{array}{c}
-f_{c,t}\hat{\beta}_{1}\\
\vdots\\
-f_{c,t}\hat{\beta}_{N}
\end{array}\right]\\
0 &amp; 0 &amp; I_{K}
\end{array}\right]\end{split}\]</div>
<p><span class="math">\(S\)</span> is an estimator of the covariance of the moment conditions,
<span class="math">\(g_{t}\)</span>, and its form is identical to either the
heteroskedasticity consistent estimator or the HAC estimator in the
previous section. The parameter covariance estimator uses the form
appropriate for efficient GMM,</p>
<div class="math">
\[\hat{\Sigma}=\left(\hat{G}\hat{^{\prime}S}^{-1}\hat{G}\right)^{-1}.\]</div>
<p>Sources used in writing the code include <a class="reference internal" href="../references.html#bryzgalova" id="id2">[Bryzgalova]</a>, <a class="reference internal" href="../references.html#cochrane" id="id3">[Cochrane]</a> and <a class="reference internal" href="../references.html#jagannathanetal" id="id4">[JagannathanEtAl]</a>.</p>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="covariance.html" title="previous chapter (use the left arrow)">Linear Asset Pricing Model Covariance Estimators</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="../system/index.html" title="next chapter (use the right arrow)">System Regression Models</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../system/index.html" title="System Regression Models"
             >next</a> |</li>
        <li class="right" >
          <a href="covariance.html" title="Linear Asset Pricing Model Covariance Estimators"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">linearmodels 4.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Linear Factor Models for Asset Pricing</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2017, Kevin Sheppard. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>